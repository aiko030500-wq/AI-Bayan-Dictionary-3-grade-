<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ENGLISH WITH AI BAYAN ‚Äî Unit 1 (Lessons 1‚Äì8)</title>
  <style>
    :root{
      --bg:#0b3b2f;
      --gold:#f4c542;
      --card:#ffffff;
      --soft:#eaf7ef;
      --text:#0a1f16;
      --muted:#4b6b5c;
      --radius:18px;
      --shadow:0 10px 28px rgba(0,0,0,.18);
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background: linear-gradient(180deg, var(--bg), #0a2f26);
      color:#fff;
      min-height:100vh;
    }
    .wrap{max-width:980px;margin:0 auto;padding:18px 14px 80px}
    .top{
      border:4px solid var(--gold);
      border-radius:26px;
      padding:18px 16px;
      background: rgba(0,0,0,.12);
      box-shadow: var(--shadow);
      position:relative;
      overflow:hidden;
    }
    .logoCircle{
      width:108px;height:108px;border-radius:999px;
      border:6px solid var(--gold);
      background:#fff;
      margin:0 auto 10px;
    }
    .title{
      text-align:center;
      font-weight:900;
      letter-spacing:1px;
      margin:6px 0 0;
      font-size:28px;
    }
    .subtitle{
      text-align:center;
      margin:6px 0 0;
      font-weight:700;
      opacity:.95;
      font-size:16px;
    }
    .card{
      margin-top:16px;
      background: var(--card);
      color: var(--text);
      border-radius: var(--radius);
      border:4px solid var(--gold);
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .cardHeader{
      padding:14px 14px;
      color:#fff;
      font-weight:900;
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:10px;
    }
    .cardHeader h2{margin:0;font-size:20px}
    .cardHeader .small{margin-top:4px;font-weight:700;opacity:.95}
    .starsLine{font-weight:900}
    .content{padding:14px}
    .pillRow{
      display:flex;flex-wrap:wrap;gap:10px;
      margin:10px 0 8px;
    }
    .mini-tab{
      border:0;
      padding:10px 12px;
      border-radius:999px;
      font-weight:900;
      cursor:pointer;
      color:#fff;
      box-shadow: 0 10px 18px rgba(0,0,0,.12);
    }
    .section{
      margin-top:14px;
      border:2px dashed rgba(0,0,0,.18);
      border-radius:16px;
      padding:12px;
      background:#fff;
    }
    .sectionTitle{
      display:flex;align-items:center;gap:10px;
      font-weight:900;font-size:18px;margin:0 0 6px;
    }
    .hint{margin:0 0 10px;color:var(--muted);font-weight:700}
    .grid{
      display:grid;
      grid-template-columns: repeat(2, minmax(0,1fr));
      gap:12px;
    }
    @media (max-width:520px){ .grid{grid-template-columns:1fr} }

    .vCard{
      background: var(--soft);
      border:2px solid rgba(0,0,0,.12);
      border-radius:16px;
      padding:12px;
      text-align:center;
    }
    .pic{
      width:84px;height:84px;border-radius:18px;
      background:#fff;
      border:2px solid rgba(0,0,0,.12);
      display:grid;place-items:center;
      margin:0 auto 8px;
      font-size:40px;
    }
    .wEng{font-weight:1000;font-size:20px;line-height:1.05}
    .wRus{margin-top:2px;color:var(--muted);font-weight:800}
    .btn{
      border:0;
      padding:10px 14px;
      border-radius:14px;
      font-weight:1000;
      cursor:pointer;
      color:#fff;
      display:inline-flex;align-items:center;gap:8px;
      box-shadow: 0 10px 18px rgba(0,0,0,.12);
    }
    .btnLine{display:flex;gap:10px;flex-wrap:wrap;margin-top:10px}
    .ruleBox{
      background:#dff2ff;
      border:2px solid rgba(0,0,0,.12);
      border-radius:16px;
      padding:12px;
    }
    .ruleBox h3{margin:0 0 6px;font-size:20px}
    .ruleBox p{margin:6px 0;color:#123; font-weight:700}
    .ruleBox ul{margin:6px 0 0;padding-left:18px;color:#123;font-weight:800}

    .wsRow{margin:10px 0}
    .wsLabel{font-weight:900;margin-bottom:6px}
    input[type="text"], select{
      width:100%;
      padding:12px 12px;
      border-radius:14px;
      border:2px solid rgba(0,0,0,.18);
      font-size:16px;
      outline:none;
      background:#fff;
    }
    .statusText{margin-top:8px;font-weight:1000}
    .ok{color:#0b7a3c}
    .bad{color:#b3261e}
    .reading-dialogue{
      background:#fff7d6;
      border:2px solid rgba(0,0,0,.12);
      border-radius:16px;
      padding:10px 12px;
      margin:8px 0 10px;
      color:#3a2a00;
      font-weight:900;
      line-height:1.55;
    }
    .karaoke{
      background:#101820;
      color:#eaf7ef;
      border-radius:16px;
      padding:12px;
      border:2px solid rgba(255,255,255,.12);
      font-weight:900;
      line-height:1.6;
    }
    .karaoke .line{
      padding:6px 8px;
      border-radius:12px;
      opacity:.65;
    }
    .karaoke .active{
      opacity:1;
      outline:2px solid rgba(244,197,66,.75);
      background: rgba(244,197,66,.12);
    }

    .backBar{
      position:fixed;left:0;right:0;bottom:0;
      padding:10px 12px;
      background: rgba(0,0,0,.35);
      backdrop-filter: blur(8px);
      border-top:1px solid rgba(255,255,255,.14);
      display:flex;gap:10px;justify-content:center;flex-wrap:wrap;
    }
    .footerNote{
      position:fixed;left:0;right:0;bottom:56px;
      text-align:center;
      font-weight:900;
      padding:6px 10px;
      color:#fff;
      opacity:.95;
      text-shadow:0 2px 12px rgba(0,0,0,.35);
    }

    /* Print */
    @media print{
      body{background:#fff;color:#000}
      .backBar,.footerNote{display:none !important}
      .top{border-color:#000;background:#fff;color:#000}
      .card{box-shadow:none;border-color:#000}
      .cardHeader{color:#000 !important}
      .mini-tab,.btn{display:none !important}
    }
  </style>
</head>

<body>
  <div class="wrap" id="app"></div>

  <div class="footerNote" id="footerNote">
    Students: 3E S1‚Äì3E S15 &nbsp;|&nbsp; Student PIN 2844 &nbsp;|&nbsp; Teacher PIN 3244
  </div>

  <div class="backBar" id="backBar" style="display:none">
    <button class="btn" id="btnBack" onclick="goHome()">‚¨Ö Back to unit</button>
    <button class="btn" id="btnSave" onclick="saveLessonResult()">‚úÖ Save Result</button>
    <button class="btn" id="btnPrint" onclick="printLesson()">üñ® Print</button>
  </div>

<script>
/** =========================
 *  DATA (Unit 1 Lessons 1‚Äì8)
 *  =========================
 *  –¢–µ–∫—Å—Ç—ã/–¥–∏–∞–ª–æ–≥–∏ —è –ø–æ—Å—Ç–∞–≤–∏–ª –±–µ–∑–æ–ø–∞—Å–Ω—ã–µ ‚Äú–ø–æ —Å–º—ã—Å–ª—É‚Äù,
 *  —Ç—ã –ø–æ—Ç–æ–º –º–æ–∂–µ—à—å –∑–∞–º–µ–Ω–∏—Ç—å –Ω–∞ —Ç–æ—á–Ω—ã–µ —Å—Ç—Ä–æ–∫–∏ –∏–∑ –∫–Ω–∏–≥–∏.
 */

const lessons = [
  {
    id: 1,
    title: "Lesson 1 ‚Äì Greetings & names",
    subtitle: "Hello English!",
    color: "#0a6b5a",
    show: { vocab:true, grammar:true, worksheets:true, song:false, alphabet:false },
    vocab: [
      {pic:"üëß", en:"Rosy", ru:"–†–æ–∑–∏"},
      {pic:"üë¶", en:"Tim", ru:"–¢–∏–º"},
      {pic:"üßí", en:"Billy", ru:"–ë–∏–ª–ª–∏"},
      {pic:"üë©‚Äçüè´", en:"Miss Jones", ru:"–º–∏—Å—Å –î–∂–æ–Ω—Å"},
      {pic:"üëã", en:"Hello", ru:"–ø—Ä–∏–≤–µ—Ç"},
      {pic:"üëã", en:"Goodbye", ru:"–ø–æ–∫–∞"}
    ],
    grammar: {
      title: "What‚Äôs your name?",
      rule: `We ask: <b>What‚Äôs your name?</b><br>We answer: <b>My name‚Äôs ...</b>`,
      formula: `Formula: What‚Äôs your name? ‚Üí My name‚Äôs + Name.`,
      examples: [
        `What‚Äôs your name? ‚Äî My name‚Äôs Rosy.`,
        `What‚Äôs your name? ‚Äî My name‚Äôs Tim.`
      ]
    },
    worksheets: {
      // WS1 = grammar choose
      ws1: {
        title:"Worksheet 1 ‚Äì Grammar choose",
        items:[
          { q:"1) What‚Äôs your name? ‚Äî ____ name‚Äôs Rosy.", options:["My","I","She"], answer:"My" },
          { q:"2) ____ your name?", options:["What","Where","How"], answer:"What" },
          { q:"3) My name‚Äôs ____.", options:["Rosy","fine","ten"], answer:"Rosy" }
        ]
      },
      // WS2 = matching
      ws2: {
        title:"Worksheet 2 ‚Äì Matching picture and word",
        items:[
          { pic:"üëß", answer:"Rosy", options:["Tim","Rosy","Billy"] },
          { pic:"üë¶", answer:"Tim",  options:["Tim","Miss Jones","Hello"] },
          { pic:"üë©‚Äçüè´", answer:"Miss Jones", options:["Billy","Miss Jones","Goodbye"] }
        ]
      },
      // WS3 = vocab mini quiz
      ws3: {
        title:"Worksheet 3 ‚Äì Mini vocabulary quiz",
        items:[
          { q:"1) Choose: üëã", options:["Hello","Rosy","Tim"], answer:"Hello" },
          { q:"2) Choose: üëß", options:["Billy","Rosy","Miss Jones"], answer:"Rosy" },
          { q:"3) Choose: üë©‚Äçüè´", options:["Miss Jones","Tim","Goodbye"], answer:"Miss Jones" }
        ]
      },
      // WS4 = reading dialogue + 2 T/F
      ws4: {
        title:"Worksheet 4 ‚Äì Reading check (True / False)",
        dialogue:`Hello. What‚Äôs your name?<br>My name‚Äôs Rosy.<br>And my name‚Äôs Tim.<br>Goodbye!`,
        questions:[
          { sentence:"Rosy says: ‚ÄòMy name‚Äôs Rosy.‚Äô", answer:"True" },
          { sentence:"Tim says: ‚ÄòI‚Äôm ten.‚Äô", answer:"False" }
        ]
      }
    }
  },

  {
    id: 2,
    title: "Lesson 2 ‚Äì Alphabet",
    subtitle: "Say the letters.",
    color: "#6a2c91",
    show: { vocab:true, grammar:true, worksheets:true, song:false, alphabet:true }, // alphabet special
    vocab: [], // alphabet generated automatically
    grammar: {
      title: "Spell your name",
      rule: `We can spell: <b>My name‚Äôs ...</b> and letters.`,
      formula: `Formula: My name‚Äôs + Name. ‚Üí Spell: A-R-A-Y`,
      examples: [
        `My name‚Äôs Saken. S-A-K-E-N.`,
        `My name‚Äôs Gauhar. G-A-U-K-H-A-R.`
      ]
    },
    worksheets: {
      ws1: {
        title:"Worksheet 1 ‚Äì Grammar choose",
        items:[
          { q:"1) My name‚Äôs Adil. (Choose)", options:["My","She","They"], answer:"My" },
          { q:"2) What‚Äôs your ____ ?", options:["name","book","desk"], answer:"name" },
          { q:"3) Spell: A-R-A-Y (Choose)", options:["Aray","Rosy","Billy"], answer:"Aray" }
        ]
      }
      // WS2/WS3/WS4 not shown for alphabet
    }
  },

  {
    id: 3,
    title: "Lesson 3 ‚Äì Song",
    subtitle: "Hello, hello!",
    color: "#d23b6c",
    show: { vocab:true, grammar:true, worksheets:true, song:true, alphabet:false },
    vocab: [
      {pic:"üòä", en:"I‚Äôm fine.", ru:"—è –≤ –ø–æ—Ä—è–¥–∫–µ"},
      {pic:"‚ùì", en:"How are you?", ru:"–∫–∞–∫ —Ç—ã?"},
      {pic:"üëã", en:"Goodbye", ru:"–ø–æ–∫–∞"},
      {pic:"üôã‚Äç‚ôÄÔ∏è", en:"My name‚Äôs ...", ru:"–º–µ–Ω—è –∑–æ–≤—É—Ç ..."}
    ],
    grammar: {
      title: "How are you?",
      rule: `We ask: <b>How are you?</b><br>We answer: <b>I‚Äôm fine, thank you.</b>`,
      formula: `Formula: How are you? ‚Üí I‚Äôm fine, thank you.`,
      examples: [
        `How are you? ‚Äî I‚Äôm fine, thank you.`,
        `Goodbye! ‚Äî Bye!`
      ]
    },
    song: {
      lines:[
        "Hello, hello!",
        "How are you?",
        "I‚Äôm fine, thank you.",
        "Hello, hello!",
        "What‚Äôs your name?",
        "My name‚Äôs ____.",
        "That‚Äôs my name.",
        "Goodbye, goodbye!",
        "Goodbye to you‚Ä¶"
      ],
      intervalMs: 900
    },
    worksheets: {
      ws1: {
        title:"Worksheet 1 ‚Äì Grammar choose",
        items:[
          { q:"1) How are you? ‚Äî I‚Äôm ____.", options:["fine","two","book"], answer:"fine" },
          { q:"2) ____ are you?", options:["How","What","Where"], answer:"How" },
          { q:"3) Goodbye! ‚Äî ____.", options:["Bye","Hello","Rosy"], answer:"Bye" }
        ]
      }
    }
  },

  {
    id: 4,
    title: "Lesson 4 ‚Äì Numbers 1‚Äì20",
    subtitle: "How old are you?",
    color: "#0b6aa9",
    show: { vocab:true, grammar:true, worksheets:true, song:false, alphabet:false },
    vocab: [
      {pic:"1Ô∏è‚É£", en:"one", ru:"–æ–¥–∏–Ω"},
      {pic:"2Ô∏è‚É£", en:"two", ru:"–¥–≤–∞"},
      {pic:"3Ô∏è‚É£", en:"three", ru:"—Ç—Ä–∏"},
      {pic:"4Ô∏è‚É£", en:"four", ru:"—á–µ—Ç—ã—Ä–µ"},
      {pic:"5Ô∏è‚É£", en:"five", ru:"–ø—è—Ç—å"},
      {pic:"üîü", en:"ten", ru:"–¥–µ—Å—è—Ç—å"}
    ],
    grammar: {
      title: "How old are you?",
      rule: `We ask: <b>How old are you?</b><br>We answer: <b>I‚Äôm ...</b>`,
      formula: `Formula: How old are you? ‚Üí I‚Äôm + number.`,
      examples: [
        `How old are you? ‚Äî I‚Äôm nine.`,
        `How old is she? ‚Äî She‚Äôs ten.`
      ]
    },
    worksheets: {
      ws1: {
        title:"Worksheet 1 ‚Äì Grammar choose",
        items:[
          { q:"1) How old ____ you?", options:["are","is","am"], answer:"are" },
          { q:"2) I‚Äôm ____.", options:["nine","Rosy","Hello"], answer:"nine" },
          { q:"3) She‚Äôs ____.", options:["ten","book","fine"], answer:"ten" }
        ]
      },
      ws2: {
        title:"Worksheet 2 ‚Äì Matching picture and word",
        items:[
          { pic:"1Ô∏è‚É£", answer:"one", options:["one","two","ten"] },
          { pic:"2Ô∏è‚É£", answer:"two", options:["three","two","five"] },
          { pic:"üîü", answer:"ten", options:["ten","four","one"] }
        ]
      },
      ws3: {
        title:"Worksheet 3 ‚Äì Mini vocabulary quiz",
        items:[
          { q:"1) Choose: 4Ô∏è‚É£", options:["four","five","two"], answer:"four" },
          { q:"2) Choose: 3Ô∏è‚É£", options:["one","three","ten"], answer:"three" },
          { q:"3) Choose: 5Ô∏è‚É£", options:["five","two","four"], answer:"five" }
        ]
      },
      ws4: {
        title:"Worksheet 4 ‚Äì Reading check (True / False)",
        dialogue:`Hi, Billy. How old are you?<br>I‚Äôm two.<br>I‚Äôm sorry. Come on, Billy.<br>Goodbye!`,
        questions:[
          { sentence:"Billy is two.", answer:"True" },
          { sentence:"Billy is ten.", answer:"False" }
        ]
      }
    }
  },

  {
    id: 5,
    title: "Lesson 5 ‚Äì Colours",
    subtitle: "Skills time!",
    color: "#1b7d3a",
    show: { vocab:true, grammar:true, worksheets:true, song:false, alphabet:false },
    vocab: [
      {pic:"üü•", en:"red", ru:"–∫—Ä–∞—Å–Ω—ã–π"},
      {pic:"üü®", en:"yellow", ru:"–∂—ë–ª—Ç—ã–π"},
      {pic:"üü©", en:"green", ru:"–∑–µ–ª—ë–Ω—ã–π"},
      {pic:"üü¶", en:"blue", ru:"—Å–∏–Ω–∏–π"},
      {pic:"‚¨õ", en:"black", ru:"—á—ë—Ä–Ω—ã–π"},
      {pic:"‚¨ú", en:"white", ru:"–±–µ–ª—ã–π"}
    ],
    grammar: {
      title: "It is ‚Ä¶ / My favourite colour is ‚Ä¶",
      rule: `We say colours: <b>It is red.</b> / <b>My favourite colour is blue.</b>`,
      formula: `Formula: It is + colour. | My favourite colour is + colour.`,
      examples: [
        `It is red.`,
        `My favourite colour is green.`
      ]
    },
    worksheets: {
      ws1: {
        title:"Worksheet 1 ‚Äì Grammar choose",
        items:[
          { q:"1) My favourite colour ____ red.", options:["is","are","am"], answer:"is" },
          { q:"2) It ____ blue.", options:["is","are","am"], answer:"is" },
          { q:"3) Choose a colour:", options:["green","Tim","nine"], answer:"green" }
        ]
      },
      ws2: {
        title:"Worksheet 2 ‚Äì Matching picture and word",
        items:[
          { pic:"üü•", answer:"red", options:["red","blue","green"] },
          { pic:"üü©", answer:"green", options:["yellow","green","white"] },
          { pic:"üü¶", answer:"blue", options:["blue","black","red"] }
        ]
      },
      ws3: {
        title:"Worksheet 3 ‚Äì Mini vocabulary quiz",
        items:[
          { q:"1) Choose: üü®", options:["yellow","black","blue"], answer:"yellow" },
          { q:"2) Choose: ‚¨õ", options:["white","black","green"], answer:"black" },
          { q:"3) Choose: ‚¨ú", options:["white","red","yellow"], answer:"white" }
        ]
      },
      ws4: {
        title:"Worksheet 4 ‚Äì Reading check (True / False)",
        dialogue:`My favourite colour is red.<br>My favourite colour is green.<br>It is blue and yellow.`,
        questions:[
          { sentence:"A favourite colour can be red.", answer:"True" },
          { sentence:"Blue is a number.", answer:"False" }
        ]
      }
    }
  },

  {
    id: 6,
    title: "Lesson 6 ‚Äì Name, age, country",
    subtitle: "Where are you from?",
    color: "#b24a00",
    show: { vocab:true, grammar:true, worksheets:true, song:false, alphabet:false },
    vocab: [
      {pic:"üá∞üáø", en:"Kazakhstan", ru:"–ö–∞–∑–∞—Ö—Å—Ç–∞–Ω"},
      {pic:"üá¨üáß", en:"the UK", ru:"–í–µ–ª–∏–∫–æ–±—Ä–∏—Ç–∞–Ω–∏—è"},
      {pic:"üá∫üá∏", en:"the USA", ru:"–°–®–ê"},
      {pic:"üßí", en:"She‚Äôs ‚Ä¶", ru:"–µ–π ‚Ä¶"},
      {pic:"üó£Ô∏è", en:"I‚Äôm from ‚Ä¶", ru:"—è –∏–∑ ‚Ä¶"},
      {pic:"üéÇ", en:"nine", ru:"–¥–µ–≤—è—Ç—å"}
    ],
    grammar: {
      title: "Where are you from?",
      rule: `We ask: <b>Where are you from?</b><br>We answer: <b>I‚Äôm from ...</b>`,
      formula: `Formula: Where are you from? ‚Üí I‚Äôm from + country.`,
      examples: [
        `Where are you from? ‚Äî I‚Äôm from Kazakhstan.`,
        `What‚Äôs your name? ‚Äî My name‚Äôs Aizere.`
      ]
    },
    worksheets: {
      ws1: {
        title:"Worksheet 1 ‚Äì Grammar choose",
        items:[
          { q:"1) I‚Äôm ____ Kazakhstan.", options:["from","on","in"], answer:"from" },
          { q:"2) Where ____ you from?", options:["are","is","am"], answer:"are" },
          { q:"3) She‚Äôs ____.", options:["nine","desk","hello"], answer:"nine" }
        ]
      },
      ws2: {
        title:"Worksheet 2 ‚Äì Matching picture and word",
        items:[
          { pic:"üá∞üáø", answer:"Kazakhstan", options:["Kazakhstan","the UK","the USA"] },
          { pic:"üá¨üáß", answer:"the UK", options:["the UK","Kazakhstan","the USA"] },
          { pic:"üá∫üá∏", answer:"the USA", options:["the USA","the UK","Kazakhstan"] }
        ]
      },
      ws3: {
        title:"Worksheet 3 ‚Äì Mini vocabulary quiz",
        items:[
          { q:"1) Choose: I‚Äôm ____ Kazakhstan.", options:["from","fine","name"], answer:"from" },
          { q:"2) Choose: üá¨üáß", options:["the UK","the USA","Kazakhstan"], answer:"the UK" },
          { q:"3) Choose: üá∞üáø", options:["Kazakhstan","the UK","the USA"], answer:"Kazakhstan" }
        ]
      },
      ws4: {
        title:"Worksheet 4 ‚Äì Reading check (True / False)",
        dialogue:`What‚Äôs your name?<br>My name‚Äôs Aizere.<br>How old are you?<br>I‚Äôm nine.<br>Where are you from?<br>I‚Äôm from Kazakhstan.`,
        questions:[
          { sentence:"Aizere is nine.", answer:"True" },
          { sentence:"Aizere is from the USA.", answer:"False" }
        ]
      }
    }
  },

  {
    id: 7,
    title: "Lesson 7 ‚Äì Project",
    subtitle: "Make a poster about you.",
    color: "#006b80",
    show: { vocab:true, grammar:true, worksheets:true, song:false, alphabet:false },
    vocab: [
      {pic:"üßç‚Äç‚ôÄÔ∏è", en:"My name‚Äôs ‚Ä¶", ru:"–º–µ–Ω—è –∑–æ–≤—É—Ç ‚Ä¶"},
      {pic:"üéÇ", en:"I‚Äôm ‚Ä¶", ru:"–º–Ω–µ ‚Ä¶"},
      {pic:"üåç", en:"I‚Äôm from ‚Ä¶", ru:"—è –∏–∑ ‚Ä¶"},
      {pic:"üé®", en:"favourite colour", ru:"–ª—é–±–∏–º—ã–π —Ü–≤–µ—Ç"},
      {pic:"üü¶", en:"blue", ru:"—Å–∏–Ω–∏–π"},
      {pic:"üü•", en:"red", ru:"–∫—Ä–∞—Å–Ω—ã–π"}
    ],
    grammar: {
      title: "About me",
      rule: `We can say: <b>My name‚Äôs ‚Ä¶</b> / <b>I‚Äôm ‚Ä¶</b> / <b>I‚Äôm from ‚Ä¶</b>`,
      formula: `Formula: My name‚Äôs + Name. | I‚Äôm + age. | I‚Äôm from + country.`,
      examples: [
        `My name‚Äôs Birzhan. I‚Äôm ten. I‚Äôm from Kazakhstan.`,
        `My favourite colour is red.`
      ]
    },
    worksheets: {
      ws1: {
        title:"Worksheet 1 ‚Äì Grammar choose",
        items:[
          { q:"1) My name‚Äôs ____.", options:["Birzhan","red","nine"], answer:"Birzhan" },
          { q:"2) I‚Äôm ____.", options:["ten","blue","UK"], answer:"ten" },
          { q:"3) My favourite colour is ____.", options:["red","Tim","two"], answer:"red" }
        ]
      },
      ws2: {
        title:"Worksheet 2 ‚Äì Matching picture and word",
        items:[
          { pic:"üéÇ", answer:"age", options:["age","name","colour"] },
          { pic:"üé®", answer:"colour", options:["country","colour","name"] },
          { pic:"üåç", answer:"country", options:["country","age","colour"] }
        ]
      },
      ws3: {
        title:"Worksheet 3 ‚Äì Mini vocabulary quiz",
        items:[
          { q:"1) Choose: üé®", options:["colour","name","age"], answer:"colour" },
          { q:"2) Choose: üåç", options:["country","age","hello"], answer:"country" },
          { q:"3) Choose: üéÇ", options:["age","goodbye","red"], answer:"age" }
        ]
      },
      ws4: {
        title:"Worksheet 4 ‚Äì Reading check (True / False)",
        dialogue:`My name‚Äôs Birzhan.<br>I‚Äôm ten.<br>I‚Äôm from Kazakhstan.<br>My favourite colour is red.`,
        questions:[
          { sentence:"Birzhan is ten.", answer:"True" },
          { sentence:"Birzhan is from the UK.", answer:"False" }
        ]
      }
    }
  },

  {
    id: 8,
    title: "Lesson 8 ‚Äì Culture (At my school)",
    subtitle: "Classroom instructions + prepositions",
    color: "#7a8b00",
    show: { vocab:true, grammar:true, worksheets:true, song:false, alphabet:false },
    vocab: [
      {pic:"ü™ë", en:"chair", ru:"—Å—Ç—É–ª"},
      {pic:"üßë‚Äçüè´", en:"teacher", ru:"—É—á–∏—Ç–µ–ª—å"},
      {pic:"üßè", en:"Listen!", ru:"—Å–ª—É—à–∞–π!"},
      {pic:"ü§´", en:"Don‚Äôt talk.", ru:"–Ω–µ –≥–æ–≤–æ—Ä–∏"},
      {pic:"‚û°Ô∏è", en:"next to", ru:"—Ä—è–¥–æ–º"},
      {pic:"üìç", en:"near", ru:"–≤–æ–∑–ª–µ"}
    ],
    grammar: {
      title: "Where is it? (near / next to)",
      rule: `We ask: <b>Where‚Äôs the chair?</b><br>We answer: <b>It‚Äôs near the desk.</b> / <b>It‚Äôs next to the desk.</b>`,
      formula: `Formula: Where‚Äôs + noun? ‚Üí It‚Äôs near / next to + noun.`,
      examples: [
        `Where‚Äôs the chair? ‚Äî It‚Äôs near the desk.`,
        `Where‚Äôs the pencil case? ‚Äî It‚Äôs next to the book.`
      ]
    },
    worksheets: {
      ws1: {
        title:"Worksheet 1 ‚Äì Grammar choose",
        items:[
          { q:"1) Where‚Äôs the chair? ‚Äî It‚Äôs ____ the desk.", options:["near","nine","hello"], answer:"near" },
          { q:"2) It‚Äôs ____ to the desk.", options:["next","fine","from"], answer:"next" },
          { q:"3) ____ the chair?", options:["Where‚Äôs","How","What"], answer:"Where‚Äôs" }
        ]
      },
      ws2: {
        title:"Worksheet 2 ‚Äì Matching picture and word",
        items:[
          { pic:"üßè", answer:"Listen!", options:["Listen!","Goodbye","Blue"] },
          { pic:"ü§´", answer:"Don‚Äôt talk.", options:["Don‚Äôt talk.","I‚Äôm fine.","Ten"] },
          { pic:"ü™ë", answer:"chair", options:["chair","teacher","desk"] }
        ]
      },
      ws3: {
        title:"Worksheet 3 ‚Äì Mini vocabulary quiz",
        items:[
          { q:"1) Choose: ‚û°Ô∏è", options:["next to","near","from"], answer:"next to" },
          { q:"2) Choose: üìç", options:["near","red","two"], answer:"near" },
          { q:"3) Choose: ü§´", options:["Don‚Äôt talk.","Hello","Teacher"], answer:"Don‚Äôt talk." }
        ]
      },
      ws4: {
        title:"Worksheet 4 ‚Äì Reading check (True / False)",
        dialogue:`Sit down, class.<br>Listen. Don‚Äôt talk.<br>Where‚Äôs the chair?<br>It‚Äôs near the desk.`,
        questions:[
          { sentence:"‚ÄòDon‚Äôt talk‚Äô means ‚ÄòBe quiet.‚Äô", answer:"True" },
          { sentence:"The chair is in Kazakhstan.", answer:"False" }
        ]
      }
    }
  }
];

let currentLessonId = null;
let karaokeTimer = null;
let karaokeIndex = 0;

/** ===========
 *  UI RENDER
 *  =========== */

function renderHome(){
  currentLessonId = null;
  document.getElementById("backBar").style.display = "none";
  document.getElementById("footerNote").style.display = "block";

  const app = document.getElementById("app");
  app.innerHTML = `
    <div class="top">
      <div class="logoCircle"></div>
      <div class="title">ENGLISH WITH AI BAYAN</div>
      <div class="subtitle">Grade 3 ‚Äì Family and Friends 3</div>
      <div class="subtitle" style="margin-top:6px;font-size:15px;opacity:.92">
        Unit 1 ‚Äî Lessons 1‚Äì8
      </div>
      <div class="card" style="margin-top:14px">
        <div class="cardHeader" style="background:#0a6b5a">
          <div>
            <h2>Choose a lesson</h2>
            <div class="small">Tap a card to open</div>
          </div>
          <div class="starsLine">‚≠ê Total: <span id="totalStars">0</span></div>
        </div>
        <div class="content">
          <div class="grid" id="lessonGrid"></div>
        </div>
      </div>
    </div>
  `;

  document.getElementById("totalStars").textContent = getTotalStars();

  const grid = document.getElementById("lessonGrid");
  lessons.forEach(ls=>{
    const st = getLessonStars(ls.id);
    const btn = document.createElement("button");
    btn.className = "mini-tab";
    btn.style.background = ls.color;
    btn.style.width = "100%";
    btn.style.textAlign = "left";
    btn.style.borderRadius = "18px";
    btn.style.padding = "14px";
    btn.innerHTML = `
      <div style="font-size:18px;font-weight:1000">${escapeHtml(ls.title)}</div>
      <div style="font-size:14px;opacity:.95;font-weight:800;margin-top:4px">${escapeHtml(ls.subtitle)}</div>
      <div style="margin-top:8px;font-weight:1000">‚≠ê Stars in lesson: ${st}</div>
    `;
    btn.onclick = ()=>openLesson(ls.id);
    grid.appendChild(btn);
  });
}

function openLesson(id){
  stopKaraoke();
  currentLessonId = id;
  document.getElementById("backBar").style.display = "flex";
  document.getElementById("footerNote").style.display = "none";

  const ls = lessons.find(x=>x.id===id);
  if(!ls) return;

  // apply colors to bottom buttons
  document.getElementById("btnBack").style.background = ls.color;
  document.getElementById("btnSave").style.background = ls.color;
  document.getElementById("btnPrint").style.background = ls.color;

  const stars = getLessonStars(id);

  const app = document.getElementById("app");
  app.innerHTML = `
    <div class="top" style="border-color:var(--gold)">
      <div class="logoCircle"></div>
      <div class="title">ENGLISH WITH AI BAYAN</div>
      <div class="subtitle">Grade 3 ‚Äì Family and Friends 3</div>
    </div>

    <div class="card">
      <div class="cardHeader" style="background:${ls.color}">
        <div>
          <h2>${escapeHtml(ls.title)}</h2>
          <div class="small">${escapeHtml(ls.subtitle)}</div>
          <div class="small"><b>You have ${stars} ‚≠ê in this lesson.</b></div>
        </div>
        <div style="text-align:right;font-weight:1000">
          <div style="opacity:.95">Lesson colour</div>
          <div style="margin-top:6px;width:36px;height:36px;border-radius:12px;background:#fff;border:3px solid rgba(0,0,0,.15)"></div>
        </div>
      </div>
      <div class="content">
        <div class="pillRow" id="lessonMenu"></div>
        <div id="lessonBody"></div>
      </div>
    </div>
  `;

  const menu = document.getElementById("lessonMenu");
  const addTab = (label, targetId) => {
    const b = document.createElement("button");
    b.className = "mini-tab";
    b.style.background = ls.color;
    b.textContent = label;
    b.onclick = ()=>document.getElementById(targetId)?.scrollIntoView({behavior:"smooth", block:"start"});
    menu.appendChild(b);
  };

  if(ls.show.vocab) addTab("üß† VOCABULARY", "sec-vocab");
  if(ls.show.grammar) addTab("üìò GRAMMAR", "sec-grammar");
  if(ls.show.worksheets) addTab("üìÑ WORKSHEETS", "sec-ws");
  addTab("üñ® PRINT", "sec-print");

  const body = document.getElementById("lessonBody");

  // Vocabulary
  if(ls.show.vocab){
    const sec = document.createElement("div");
    sec.className = "section";
    sec.id = "sec-vocab";
    sec.innerHTML = `
      <div class="sectionTitle">üß† VOCABULARY ‚Äî Picture words</div>
      <p class="hint">Tap ‚ÄúSay it‚Äù to hear AI Bayan (device TTS).</p>
      <div class="grid" id="vGrid"></div>
    `;
    body.appendChild(sec);

    const vGrid = sec.querySelector("#vGrid");
    if(ls.show.alphabet){
      const letters = "ABCDEFGHIJKLMNOPQRSTUVWXYZ".split("");
      letters.forEach(ch=>{
        vGrid.appendChild(vocabCard({pic:ch, en: ch, ru:""} , ls.color));
      });
    } else {
      (ls.vocab || []).forEach(item=>vGrid.appendChild(vocabCard(item, ls.color)));
    }
  }

  // Song karaoke section
  if(ls.show.song && ls.song){
    const sec = document.createElement("div");
    sec.className = "section";
    sec.id = "sec-song";
    sec.innerHTML = `
      <div class="sectionTitle">üéµ SONG ‚Äî Karaoke</div>
      <p class="hint">Press Play ‚Äî lines will highlight like karaoke (no mp3 yet).</p>
      <div class="karaoke" id="karaokeBox"></div>
      <div class="btnLine">
        <button class="btn" style="background:${ls.color}" onclick="startKaraoke(${ls.id})">‚ñ∂ Play</button>
        <button class="btn" style="background:${ls.color}" onclick="stopKaraoke()">‚èπ Stop</button>
      </div>
    `;
    body.appendChild(sec);
    renderKaraoke(ls);
  }

  // Grammar
  if(ls.show.grammar){
    const sec = document.createElement("div");
    sec.className = "section";
    sec.id = "sec-grammar";
    sec.innerHTML = `
      <div class="sectionTitle">üìò GRAMMAR ‚Äî Key Rule</div>
      <div class="ruleBox">
        <h3>${escapeHtml(ls.grammar?.title || "Grammar")}</h3>
        <p>${ls.grammar?.rule || ""}</p>
        <p><b>${escapeHtml(ls.grammar?.formula || "")}</b></p>
        <div style="margin-top:8px;font-weight:1000">Examples:</div>
        <ul>
          ${(ls.grammar?.examples||[]).map(x=>`<li>${escapeHtml(x)}</li>`).join("")}
        </ul>
      </div>
    `;
    body.appendChild(sec);
  }

  // Worksheets
  if(ls.show.worksheets){
    const sec = document.createElement("div");
    sec.className = "section";
    sec.id = "sec-ws";
    sec.innerHTML = `
      <div class="sectionTitle">üìÑ WORKSHEETS</div>
      <p class="hint">Do tasks ‚Üí Check ‚úî ‚Üí Stars are added for correct answers.</p>
      <div id="wsHolder"></div>
    `;
    body.appendChild(sec);

    const holder = sec.querySelector("#wsHolder");
    buildWorksheets(holder, ls);
  }

  // Print
  const secP = document.createElement("div");
  secP.className = "section";
  secP.id = "sec-print";
  secP.innerHTML = `
    <div class="sectionTitle">üñ® PRINT</div>
    <p class="hint">Print this lesson: Vocabulary + Grammar + Worksheets.</p>
    <button class="btn" style="background:${ls.color}" onclick="printLesson()">üñ® Print lesson</button>
  `;
  body.appendChild(secP);

  // Scroll top
  window.scrollTo({top:0, behavior:"smooth"});
}

function vocabCard(item, color){
  const wrap = document.createElement("div");
  wrap.className = "vCard";
  wrap.innerHTML = `
    <div class="pic">${escapeHtml(item.pic||"")}</div>
    <div class="wEng">${escapeHtml(item.en||"")}</div>
    ${item.ru ? `<div class="wRus">${escapeHtml(item.ru)}</div>` : `<div style="height:20px"></div>`}
    <div class="btnLine" style="justify-content:center;margin-top:10px">
      <button class="btn" style="background:${color}" onclick="sayText('${jsQuote(item.en||"")}')">üîä Say it</button>
    </div>
  `;
  return wrap;
}

/** ======================
 *  WORKSHEETS (WS1‚ÄìWS4)
 *  ====================== */
function buildWorksheets(container, lesson){
  const ws = lesson.worksheets || {};

  // Alphabet lesson special: only WS1
  if(lesson.show.alphabet){
    if(ws.ws1) container.appendChild(wsChooseBlock("ws1", ws.ws1, lesson.color));
    return;
  }

  if(ws.ws1) container.appendChild(wsChooseBlock("ws1", ws.ws1, lesson.color));
  if(ws.ws2) container.appendChild(wsMatchingBlock("ws2", ws.ws2, lesson.color));
  if(ws.ws3) container.appendChild(wsChooseBlock("ws3", ws.ws3, lesson.color)); // mini vocab quiz (choose)
  if(ws.ws4) container.appendChild(wsReadingTFBlock("ws4", ws.ws4, lesson.color));
}

function wsChooseBlock(key, data, color){
  const box = document.createElement("div");
  box.style.marginTop = "14px";
  box.innerHTML = `<h3 style="margin:0 0 10px">${escapeHtml(data.title)}</h3>`;
  (data.items||[]).forEach((it, idx)=>{
    const row = document.createElement("div");
    row.className = "wsRow";
    row.innerHTML = `
      <div class="wsLabel">${escapeHtml(it.q)}</div>
      <select data-ws="${key}" data-index="${idx}">
        <option value="">-- choose --</option>
        ${(it.options||[]).map(o=>`<option value="${escapeHtml(o)}">${escapeHtml(o)}</option>`).join("")}
      </select>
    `;
    box.appendChild(row);
  });
  const btnLine = document.createElement("div");
  btnLine.className = "btnLine";
  btnLine.innerHTML = `
    <button class="btn" style="background:${color}" onclick="checkWorksheet('${key}')">Check ‚úî</button>
    <div class="statusText" id="status-${key}"></div>
  `;
  box.appendChild(btnLine);
  return box;
}

function wsMatchingBlock(key, data, color){
  const box = document.createElement("div");
  box.style.marginTop = "14px";
  box.innerHTML = `<h3 style="margin:0 0 10px">${escapeHtml(data.title)}</h3>
                   <p class="hint" style="margin-top:-4px">Choose the correct word for each picture.</p>`;
  (data.items||[]).forEach((it, idx)=>{
    const row = document.createElement("div");
    row.className = "wsRow";
    row.innerHTML = `
      <div class="wsLabel">${idx+1}) <span style="font-size:28px">${escapeHtml(it.pic||"")}</span></div>
      <select data-ws="${key}" data-index="${idx}">
        <option value="">-- choose --</option>
        ${(it.options||[]).map(o=>`<option value="${escapeHtml(o)}">${escapeHtml(o)}</option>`).join("")}
      </select>
    `;
    box.appendChild(row);
  });
  const btnLine = document.createElement("div");
  btnLine.className = "btnLine";
  btnLine.innerHTML = `
    <button class="btn" style="background:${color}" onclick="checkWorksheet('${key}')">Check ‚úî</button>
    <div class="statusText" id="status-${key}"></div>
  `;
  box.appendChild(btnLine);
  return box;
}

function wsReadingTFBlock(key, data, color){
  const box = document.createElement("div");
  box.style.marginTop = "14px";
  box.innerHTML = `<h3 style="margin:0 0 8px">${escapeHtml(data.title)}</h3>
                   <div class="reading-dialogue">${data.dialogue || ""}</div>`;
  (data.questions||[]).forEach((it, idx)=>{
    const row = document.createElement("div");
    row.className = "wsRow";
    row.innerHTML = `
      <div class="wsLabel">${idx+1}) ${escapeHtml(it.sentence)}</div>
      <select data-ws="${key}" data-index="${idx}">
        <option value="">-- choose --</option>
        <option value="True">True</option>
        <option value="False">False</option>
      </select>
    `;
    box.appendChild(row);
  });
  const btnLine = document.createElement("div");
  btnLine.className = "btnLine";
  btnLine.innerHTML = `
    <button class="btn" style="background:${color}" onclick="checkWorksheet('${key}')">Check ‚úî</button>
    <div class="statusText" id="status-${key}"></div>
  `;
  box.appendChild(btnLine);
  return box;
}

/** ======================
 *  CHECK + STARS
 *  ====================== */
function checkWorksheet(key){
  const ls = lessons.find(x=>x.id===currentLessonId);
  if(!ls) return;
  const ws = ls.worksheets?.[key];
  if(!ws) return;

  const selects = Array.from(document.querySelectorAll(`select[data-ws="${key}"]`));
  let total = selects.length;
  let correct = 0;

  selects.forEach(sel=>{
    const idx = Number(sel.getAttribute("data-index"));
    const val = sel.value;

    let ans = "";
    if(key==="ws2"){
      ans = (ws.items?.[idx]?.answer || "");
    } else if(key==="ws4"){
      ans = (ws.questions?.[idx]?.answer || "");
    } else {
      ans = (ws.items?.[idx]?.answer || "");
    }

    if(val && val === ans){
      correct++;
      sel.style.borderColor = "rgba(11,122,60,.9)";
      sel.style.background = "#eefaf2";
    }else{
      sel.style.borderColor = "rgba(179,38,30,.8)";
      sel.style.background = "#fff1f0";
    }
  });

  // stars: add +1 star for each correct answer (simple and clear)
  addStars(ls.id, correct);

  const st = document.getElementById(`status-${key}`);
  if(st){
    st.innerHTML = `<span class="${correct===total ? "ok":"bad"}">Correct: ${correct} / ${total}</span>`;
  }

  // refresh header stars line
  const header = document.querySelector(".cardHeader .small b");
  if(header) header.textContent = `You have ${getLessonStars(ls.id)} ‚≠ê in this lesson.`;
}

function addStars(lessonId, add){
  const k = `aib_u1_l${lessonId}_stars`;
  const cur = Number(localStorage.getItem(k) || "0");
  localStorage.setItem(k, String(cur + add));
}
function getLessonStars(lessonId){
  return Number(localStorage.getItem(`aib_u1_l${lessonId}_stars`) || "0");
}
function getTotalStars(){
  return lessons.reduce((sum, ls)=>sum + getLessonStars(ls.id), 0);
}

function saveLessonResult(){
  // here we just show a nice alert; stars already stored automatically
  const ls = lessons.find(x=>x.id===currentLessonId);
  if(!ls) return;
  alert(`Saved ‚úÖ\n${ls.title}\nStars in lesson: ${getLessonStars(ls.id)}`);
}

function printLesson(){
  window.print();
}

function goHome(){
  stopKaraoke();
  renderHome();
}

/** ======================
 *  TTS
 *  ====================== */
function sayText(text){
  try{
    const u = new SpeechSynthesisUtterance(text);
    u.lang = "en-US";
    speechSynthesis.cancel();
    speechSynthesis.speak(u);
  }catch(e){
    alert("TTS not supported on this device/browser.");
  }
}

/** ======================
 *  Karaoke (no audio)
 *  ====================== */
function renderKaraoke(lesson){
  const box = document.getElementById("karaokeBox");
  if(!box) return;
  box.innerHTML = (lesson.song.lines||[]).map((ln,i)=>(
    `<div class="line ${i===0?"active":""}" data-line="${i}">${escapeHtml(ln)}</div>`
  )).join("");
}
function startKaraoke(lessonId){
  stopKaraoke();
  const lesson = lessons.find(x=>x.id===lessonId);
  if(!lesson?.song) return;

  karaokeIndex = 0;
  highlightKaraokeLine(karaokeIndex);

  karaokeTimer = setInterval(()=>{
    karaokeIndex++;
    if(karaokeIndex >= lesson.song.lines.length){
      stopKaraoke();
      return;
    }
    highlightKaraokeLine(karaokeIndex);
  }, lesson.song.intervalMs || 900);
}
function highlightKaraokeLine(i){
  const box = document.getElementById("karaokeBox");
  if(!box) return;
  box.querySelectorAll(".line").forEach(el=>{
    el.classList.remove("active");
  });
  const el = box.querySelector(`.line[data-line="${i}"]`);
  if(el){
    el.classList.add("active");
    el.scrollIntoView({behavior:"smooth", block:"nearest"});
  }
}
function stopKaraoke(){
  if(karaokeTimer){ clearInterval(karaokeTimer); karaokeTimer = null; }
}

/** ======================
 *  Helpers
 *  ====================== */
function escapeHtml(s){
  return String(s ?? "")
    .replaceAll("&","&amp;")
    .replaceAll("<","&lt;")
    .replaceAll(">","&gt;")
    .replaceAll('"',"&quot;")
    .replaceAll("'","&#039;");
}
function jsQuote(s){
  return String(s ?? "").replaceAll("\\","\\\\").replaceAll("'","\\'");
}

// init
renderHome();
</script>
</body>
</html>

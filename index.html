<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>AI BAYAN ‚Ä¢ Visual Vocabulary ‚Ä¢ Grade 3</title>

  <style>
    :root{
      --appA:#0b6f78;
      --appB:#0a5f67;

      --secA:#0b6f78;
      --secB:#15909b;

      --gold:#f3c84b;
      --ink:#0a3c42;
      --paper:#ffffff;
      --soft:#eaf6f8;
      --good:#1aa06c;
      --bad:#d62828;
      --radius:22px;
      --shadow:0 12px 26px rgba(0,0,0,.16);
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;
      background:linear-gradient(180deg,var(--appA),var(--appB));
      color:#fff;
      transition: background .25s ease;
    }
    .app{max-width:860px;margin:0 auto;min-height:100vh;padding:16px 12px 30px}
    .hero{text-align:center;padding:18px 10px 8px;}
    .logoWrap{
      width:120px;height:120px;border-radius:999px;
      margin:0 auto 10px;
      border:5px solid rgba(243,200,75,.95);
      background:#fff;
      box-shadow:0 10px 22px rgba(0,0,0,.20);
      overflow:hidden;
      display:flex;align-items:center;justify-content:center;
    }
    .logoWrap img{width:100%;height:100%;object-fit:cover}
    .brandTitle{
      font-weight:1000;
      letter-spacing:.6px;
      color:var(--gold);
      text-transform:uppercase;
      font-size:28px;
      text-shadow:0 4px 12px rgba(0,0,0,.25);
      margin:0;
    }
    .brandSub{margin:6px 0 0;font-weight:900;opacity:.95}

    .panel{
      background:var(--paper);
      color:var(--ink);
      border-radius:26px;
      padding:14px;
      margin:14px auto 0;
      border:3px solid rgba(243,200,75,.70);
      box-shadow:var(--shadow);
    }

    .row{display:flex;gap:10px;flex-wrap:wrap}
    .field{margin:10px 0}
    .label{font-weight:1000;color:#0a4a52;margin-bottom:6px}
    .input{
      width:100%;
      padding:12px 12px;
      border-radius:14px;
      border:2px solid rgba(12,106,115,.25);
      outline:none;
      font-size:16px;
    }

    .btn{
      border:none;
      border-radius:16px;
      padding:12px 14px;
      font-weight:1000;
      cursor:pointer;
      box-shadow:0 10px 18px rgba(0,0,0,.10);
      user-select:none;
    }
    .btnPrimary{background:linear-gradient(180deg,#0d7a83,#0b6168);color:#fff;}
    .btnGhost{background:#fff;border:3px solid rgba(12,106,115,.55);color:#0a4a52;}
    .btn:active{transform:scale(.99)}

    .helloCard{
      background:linear-gradient(180deg,#ffffff,#f4fbfc);
      border-radius:18px;
      padding:12px;
      text-align:center;
      border:2px solid rgba(12,106,115,.20);
      margin-bottom:12px;
    }
    .helloCard .big{font-size:20px;font-weight:1000;color:#0b4f56}
    .helloCard .small{font-weight:900;color:#355e64;margin-top:4px}

    .menuGrid{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    .menuBtn{
      border-radius:18px;
      padding:14px 12px;
      background:#fff;
      border:3px solid rgba(12,106,115,.35);
      color:#0a4a52;
      font-weight:1000;
      text-align:center;
      box-shadow:0 10px 18px rgba(0,0,0,.08);
      position:relative;
      overflow:hidden;
    }
    .menuBtn small{display:block;font-weight:900;color:#3a6a70;margin-top:4px}
    .menuBtn:active{transform:scale(.99)}
    .unitChip{
      display:inline-flex;align-items:center;gap:8px;
      padding:7px 12px;border-radius:999px;
      background:rgba(255,255,255,.85);
      border:2px solid rgba(0,0,0,.06);
      box-shadow:0 10px 18px rgba(0,0,0,.06);
      font-weight:1000;
    }
    .dot{width:12px;height:12px;border-radius:999px;border:2px solid rgba(0,0,0,.08)}

    .bottomRow{display:flex;gap:10px;flex-wrap:wrap;justify-content:center;margin-top:12px}
    .miniBtn{
      min-width:200px;
      border-radius:16px;
      padding:12px 12px;
      background:#fff;
      border:3px solid rgba(12,106,115,.35);
      color:#0a4a52;
      font-weight:1000;
      text-align:center;
      box-shadow:0 10px 18px rgba(0,0,0,.08);
    }

    .lessonBanner{
      border-radius:22px;
      padding:14px 14px;
      color:#fff;
      border:3px solid rgba(243,200,75,.70);
      box-shadow:0 12px 22px rgba(0,0,0,.12);
      display:flex;gap:12px;align-items:center;justify-content:space-between;flex-wrap:wrap;
      margin-bottom:12px;
      background:linear-gradient(90deg,var(--secA),var(--secB));
    }
    .lessonBanner .title{font-weight:1000;font-size:18px}
    .lessonBanner .sub{font-weight:900;opacity:.95;font-size:13px;margin-top:4px}
    .badge{
      background:rgba(255,255,255,.18);
      border:2px solid rgba(255,255,255,.22);
      padding:8px 12px;
      border-radius:999px;
      font-weight:1000;
      white-space:nowrap;
    }

    .sectionTitle{
      display:flex;align-items:center;gap:10px;
      padding:10px 12px;
      background:linear-gradient(90deg,var(--secA),var(--secB));
      color:#fff;
      border-radius:16px;
      font-weight:1000;
      font-size:14px;
      margin:12px 0 10px;
    }

    .vocabGrid{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:12px}
    .vCard{
      background:var(--soft);
      border-radius:18px;
      padding:10px;
      border:2px solid rgba(12,106,115,.18);
      text-align:center;
      position:relative;
    }
    .vCard img{
      width:100%;
      height:130px;
      object-fit:cover;
      border-radius:14px;
      border:2px solid rgba(0,0,0,.06);
      background:#fff;
    }
    .vWord{margin-top:8px;font-weight:1000;color:#0a4a52;font-size:18px}
    .vRu{margin-top:2px;font-weight:900;color:#3d6167}

    .wsBox{
      background:#fff;
      border-radius:18px;
      border:2px dashed rgba(0,0,0,.25);
      padding:12px;
      margin:12px 0;
    }
    .wsBox h4{margin:0 0 6px;font-size:16px;color:#0a4a52}
    .wsBox p{margin:0 0 10px;color:#4b666c;font-weight:800}

    .qRow{display:flex;gap:10px;align-items:center;flex-wrap:wrap;margin:10px 0}
    .qRow .q{font-weight:1000;color:#0a4a52}
    .qRow input[type="text"], .qRow select{
      flex:1;min-width:200px;
      padding:10px 10px;
      border-radius:12px;
      border:2px solid rgba(12,106,115,.22);
      outline:none;
      background:#fff;
      font-weight:900;
      font-size:15px;
    }

    .matchGrid{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:12px}
    .matchCard{
      background:var(--soft);
      border-radius:18px;
      padding:10px;
      border:3px solid transparent;
      position:relative;
    }
    .matchCard img{
      width:100%;
      height:140px;
      object-fit:cover;
      border-radius:14px;
      border:2px solid rgba(0,0,0,.06);
      background:#fff;
    }
    .matchCard.correct{border-color:rgba(26,160,108,.65)}
    .matchCard.wrong{border-color:rgba(214,40,40,.65)}

    .mark{position:absolute;top:10px;right:12px;font-size:24px;font-weight:1000;}
    .spark{
      position:absolute;
      top:48%;left:50%;
      transform:translate(-50%,-50%) scale(0);
      font-size:44px;
      animation:pop .6s ease forwards;
      pointer-events:none;
    }
    @keyframes pop{
      0%{transform:translate(-50%,-50%) scale(0)}
      60%{transform:translate(-50%,-50%) scale(1.3)}
      100%{transform:translate(-50%,-50%) scale(1)}
    }

    .okBorder{border-color:rgba(26,160,108,.65)!important;background:#f1fff7}
    .badBorder{border-color:rgba(214,40,40,.65)!important;background:#fff3f3}

    .navRow{display:flex;gap:10px;flex-wrap:wrap;margin-top:12px}
    .navRow .btn{flex:1;min-width:180px}

    .chatBox{
      background:#f6fbfc;
      border:2px solid rgba(12,106,115,.18);
      border-radius:18px;
      padding:12px;
      min-height:220px;
      max-height:360px;
      overflow:auto;
    }
    .msgMe{font-weight:1000;color:#0a4a52;margin-top:10px}
    .msgAi{font-weight:900;color:#2f6168;margin-top:10px}

    table{width:100%;border-collapse:collapse}
    th,td{border:1px solid rgba(0,0,0,.15);padding:8px;font-weight:900;font-size:13px;color:#0a4a52}
    th{background:#f0fbfc}

    .footline{
      margin-top:12px;
      text-align:center;
      font-size:12px;
      font-weight:1000;
      color:rgba(255,255,255,.92);
    }

    @media (max-width:520px){
      .menuGrid{grid-template-columns:1fr}
      .vocabGrid{grid-template-columns:1fr 1fr}
      .matchGrid{grid-template-columns:1fr}
      .miniBtn{min-width:160px}
    }

    @media print{
      body{background:#fff;color:#000}
      .btn,.miniBtn,.menuBtn,.bottomRow,.navRow,.footline{display:none!important}
      .panel{border:none;box-shadow:none}
      body::after{
        content:"AI BAYAN ‚Ä¢ 3 grade ‚Ä¢ 2025";
        position:fixed;
        top:40%;
        left:8%;
        font-size:42px;
        opacity:.12;
        transform:rotate(-28deg);
        color:#000;
        white-space:nowrap;
      }
    }
  </style>
</head>

<body>
  <div class="app" id="app"></div>

<script>
/* ===================== CONFIG ===================== */
const STUDENT_PIN = "2844";
const TEACHER_PIN = "3244";
const CLASS_PREFIX = "3EL";
const MAX_STUDENTS = 15;

const STORAGE_KEY = "AIB_G3_V1_DB";

/* ===================== THEMES ===================== */
const unitThemes = {
  1:{name:"Green", shades:["#E8F5E9","#C8E6C9","#A5D6A7","#81C784","#66BB6A","#4CAF50","#43A047","#2E7D32"]},
  2:{name:"Blue",  shades:["#E3F2FD","#BBDEFB","#90CAF9","#64B5F6","#42A5F5","#2196F3","#1E88E5","#1565C0"]},
  3:{name:"Pink",  shades:["#FCE4EC","#F8BBD0","#F48FB1","#F06292","#EC407A","#E91E63","#D81B60","#AD1457"]},
  4:{name:"Orange",shades:["#FFF3E0","#FFE0B2","#FFCC80","#FFB74D","#FFA726","#FB8C00","#F57C00","#E65100"]},
  5:{name:"Purple",shades:["#F3E5F5","#E1BEE7","#CE93D8","#BA68C8","#AB47BC","#9C27B0","#8E24AA","#6A1B9A"]},
  6:{name:"Teal",  shades:["#E0F2F1","#B2DFDB","#80CBC4","#4DB6AC","#26A69A","#009688","#00897B","#00695C"]},
  7:{name:"Red",   shades:["#FFEBEE","#FFCDD2","#EF9A9A","#E57373","#EF5350","#F44336","#E53935","#B71C1C"]},
  8:{name:"Gold",  shades:["#FFFDE7","#FFF9C4","#FFF59D","#FFF176","#FFEE58","#FDD835","#FBC02D","#F9A825"]}
};

/* ===================== AUTO IMAGES (SVG) ===================== */
function svgUri({title, emoji="üìò", bg="#ffffff", accent="#0b6f78"}){
  const safeTitle = String(title || "").slice(0,18);
  const svg =
`<svg xmlns="http://www.w3.org/2000/svg" width="900" height="600">
  <defs>
    <linearGradient id="g" x1="0" y1="0" x2="1" y2="1">
      <stop offset="0" stop-color="${bg}"/>
      <stop offset="1" stop-color="${accent}33"/>
    </linearGradient>
  </defs>
  <rect width="100%" height="100%" rx="36" fill="url(#g)"/>
  <circle cx="120" cy="120" r="78" fill="${accent}22" stroke="${accent}55" stroke-width="10"/>
  <text x="120" y="140" text-anchor="middle" font-size="72" font-family="system-ui,Segoe UI,Arial">${emoji}</text>

  <rect x="40" y="250" width="820" height="220" rx="30" fill="#ffffffcc" stroke="${accent}55" stroke-width="8"/>
  <text x="450" y="345" text-anchor="middle" font-size="78" font-weight="800"
        font-family="system-ui,Segoe UI,Arial" fill="${accent}">${escapeXml(safeTitle)}</text>
  <text x="450" y="415" text-anchor="middle" font-size="30" font-weight="700"
        font-family="system-ui,Segoe UI,Arial" fill="#2c3e50aa">AI BAYAN</text>
</svg>`;
  return "data:image/svg+xml;charset=UTF-8," + encodeURIComponent(svg);
}
function escapeXml(s){
  return String(s).replace(/[&<>"]/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;'}[c]));
}

function emojiForWord(en){
  const w = (en||"").toLowerCase();
  const map = {
    "hello":"üëã","goodbye":"üëã","how are you?":"üòä","fine":"üòÉ",
    "my name is‚Ä¶":"ü™™","what‚Äôs your name?":"‚ùì","i‚Äôm‚Ä¶":"üôÇ","this is‚Ä¶":"üëâ",
    "a":"üî§","b":"üî§","c":"üî§","d":"üî§",
    "one":"1Ô∏è‚É£","two":"2Ô∏è‚É£","three":"3Ô∏è‚É£","four":"4Ô∏è‚É£","five":"5Ô∏è‚É£","six":"6Ô∏è‚É£","seven":"7Ô∏è‚É£","eight":"8Ô∏è‚É£","nine":"9Ô∏è‚É£","ten":"üîü",
    "eleven":"1Ô∏è‚É£1Ô∏è‚É£","twelve":"1Ô∏è‚É£2Ô∏è‚É£","thirteen":"1Ô∏è‚É£3Ô∏è‚É£","fourteen":"1Ô∏è‚É£4Ô∏è‚É£","fifteen":"1Ô∏è‚É£5Ô∏è‚É£","sixteen":"1Ô∏è‚É£6Ô∏è‚É£","seventeen":"1Ô∏è‚É£7Ô∏è‚É£","eighteen":"1Ô∏è‚É£8Ô∏è‚É£","nineteen":"1Ô∏è‚É£9Ô∏è‚É£","twenty":"2Ô∏è‚É£0Ô∏è‚É£",
    "red":"üî¥","blue":"üîµ","green":"üü¢","yellow":"üü°","black":"‚ö´","white":"‚ö™","pink":"ü©∑","orange":"üü†","purple":"üü£",
    "kazakhstan":"üá∞üáø","the uk":"üá¨üáß","the usa":"üá∫üá∏","russia":"üá∑üá∫",
    "book":"üìò","pen":"üñäÔ∏è","pencil":"‚úèÔ∏è","bag":"üéí","desk":"ü™ë","teacher":"üë©‚Äçüè´","student":"üßí",
    "mother":"üë©","father":"üë®","sister":"üëß","brother":"üë¶","grandma":"üëµ","grandpa":"üë¥",
    "sunny":"‚òÄÔ∏è","rainy":"üåßÔ∏è","cloudy":"‚òÅÔ∏è","windy":"üí®","snowy":"‚ùÑÔ∏è",
    "football":"‚öΩ","swimming":"üèä","music":"üéµ","reading":"üìñ","drawing":"üé®",
    "headache":"ü§ï","toothache":"ü¶∑","doctor":"üßë‚Äç‚öïÔ∏è","hospital":"üè•","medicine":"üíä",
    "school":"üè´","house":"üè†","shop":"üè™","park":"üå≥","library":"üìö",
    "holiday":"üèñÔ∏è","summer":"üåû","winter":"‚õÑ","plane":"‚úàÔ∏è","train":"üöÜ"
  };
  return map[w] || "üìò";
}
function makeFallbackImg(en, unitNum, lessonIndex){
  const shades = unitThemes[unitNum]?.shades || ["#0b6f78"];
  const accent = shades[lessonIndex] || shades[5] || "#0b6f78";
  return svgUri({title: en, emoji: emojiForWord(en), bg:"#ffffff", accent});
}

/* ===================== UNIT DATA (–≥–æ—Ç–æ–≤—ã–µ 8x8) ===================== */
function lessonTemplate(unit, lessonIndex, subtitle, topic, vocabPairs, grammarTitle, rule, formula){
  const vocab = vocabPairs.map(([en,ru])=>({en,ru,img:""}));
  return {
    id:`u${unit}l${lessonIndex+1}`,
    unit, lessonIndex,
    title:`Lesson ${lessonIndex+1}`,
    subtitle,
    vocabTopic: topic,
    vocab,
    grammar:{
      title: grammarTitle,
      rule,
      formula,
      mcq:[
        {q:`Choose: ${vocab[0]?.en || "word"}`, options:[vocab[0]?.en||"a",vocab[1]?.en||"b","hello"], ans:(vocab[0]?.en||"a")},
        {q:`Choose: ${vocab[1]?.en || "word"}`, options:[vocab[2]?.en||"c",vocab[1]?.en||"b","goodbye"], ans:(vocab[1]?.en||"b")}
      ]
    },
    reading:{
      text:[`I like ${vocab[0]?.en || "books"}.`,`This is my ${vocab[1]?.en || "pen"}.`],
      tf:[
        {q:`The text has "${vocab[0]?.en || "word"}".`, ans:true},
        {q:`The text has "banana".`, ans:false},
      ]
    },
    song:null
  };
}

/* Unit 1 (–≤–∞—à) + –∞–≤—Ç–æ-–∫–∞—Ä—Ç–∏–Ω–∫–∏ */
const UNIT1 = [
  {
    id:"u1l1", unit:1, lessonIndex:0, title:"Lesson 1", subtitle:"Hello!", vocabTopic:"Greetings",
    vocab:[
      {en:"hello", ru:"–ø—Ä–∏–≤–µ—Ç", img:""},
      {en:"goodbye", ru:"–ø–æ–∫–∞", img:""},
      {en:"how are you?", ru:"–∫–∞–∫ –¥–µ–ª–∞?", img:""},
      {en:"fine", ru:"—Ö–æ—Ä–æ—à–æ", img:""},
    ],
    grammar:{
      title:"Hello / Goodbye",
      rule:"We say hello when we meet. We say goodbye when we leave.",
      formula:"Hello! | Goodbye!",
      mcq:[
        {q:"You meet your friend. You say:", options:["Goodbye","Hello","Fine"], ans:"Hello"},
        {q:"You leave the class. You say:", options:["Hello","Goodbye","How are you?"], ans:"Goodbye"},
      ]
    },
    reading:{
      text:["Hello!","My name is Tom.","How are you?","I‚Äôm fine.","Goodbye!"],
      tf:[
        {q:"Tom says ‚ÄúHello‚Äù.", ans:true},
        {q:"Tom says ‚ÄúGood morning‚Äù.", ans:false},
      ]
    },
    song:null
  },
  {
    id:"u1l2", unit:1, lessonIndex:1, title:"Lesson 2", subtitle:"My name is‚Ä¶", vocabTopic:"Names",
    vocab:[
      {en:"my name is‚Ä¶", ru:"–º–µ–Ω—è –∑–æ–≤—É—Ç‚Ä¶", img:""},
      {en:"what‚Äôs your name?", ru:"–∫–∞–∫ —Ç–µ–±—è –∑–æ–≤—É—Ç?", img:""},
      {en:"I‚Äôm‚Ä¶", ru:"—è‚Ä¶", img:""},
      {en:"this is‚Ä¶", ru:"—ç—Ç–æ‚Ä¶", img:""},
    ],
    grammar:{
      title:"What‚Äôs your name?",
      rule:'We ask: "What‚Äôs your name?" We answer: "My name is‚Ä¶ / I‚Äôm‚Ä¶".',
      formula:"What‚Äôs your name? ‚Üí I‚Äôm‚Ä¶ / My name is‚Ä¶",
      mcq:[
        {q:"You ask a name:", options:["Goodbye","What‚Äôs your name?","I‚Äôm fine"], ans:"What‚Äôs your name?"},
        {q:"You answer:", options:["I‚Äôm Anna","What‚Äôs your name?","Hello"], ans:"I‚Äôm Anna"},
      ]
    },
    reading:{
      text:["Hello!","My name is Anna.","This is Tom."],
      tf:[
        {q:"Her name is Anna.", ans:true},
        {q:"Tom is her teacher.", ans:false},
      ]
    },
    song:null
  },
  {
    id:"u1l3", unit:1, lessonIndex:2, title:"Lesson 3", subtitle:"The alphabet", vocabTopic:"Alphabet A‚ÄìD",
    vocab:[
      {en:"A", ru:"—ç–π", img:""},
      {en:"B", ru:"–±–∏", img:""},
      {en:"C", ru:"—Å–∏", img:""},
      {en:"D", ru:"–¥–∏", img:""},
    ],
    grammar:{
      title:"Spell with letters",
      rule:"We can spell words with letters.",
      formula:"A - B - C - D",
      mcq:[
        {q:"Apple starts with:", options:["B","A","D"], ans:"A"},
        {q:"Dog starts with:", options:["C","D","A"], ans:"D"},
      ]
    },
    reading:{
      text:["A is for apple.","B is for ball.","C is for cat.","D is for dog."],
      tf:[
        {q:"B is for ball.", ans:true},
        {q:"C is for dog.", ans:false},
      ]
    },
    song:null
  },
  {
    id:"u1l4", unit:1, lessonIndex:3, title:"Lesson 4", subtitle:"Numbers 1‚Äì10", vocabTopic:"Numbers",
    vocab:[
      {en:"one", ru:"–æ–¥–∏–Ω", img:""},
      {en:"two", ru:"–¥–≤–∞", img:""},
      {en:"three", ru:"—Ç—Ä–∏", img:""},
      {en:"ten", ru:"–¥–µ—Å—è—Ç—å", img:""},
    ],
    grammar:{
      title:"I‚Äôm ‚Ä¶ (age)",
      rule:'We ask: "How old are you?" We answer: "I‚Äôm ‚Ä¶".',
      formula:"How old are you? ‚Üí I‚Äôm (ten).",
      mcq:[
        {q:"How old are you? ‚Äî I‚Äôm ___", options:["blue","ten","hello"], ans:"ten"},
        {q:"Choose a number:", options:["goodbye","two","fine"], ans:"two"},
      ]
    },
    reading:{
      text:["I am Ben.","I am nine."],
      tf:[
        {q:"Ben is nine.", ans:true},
        {q:"Ben is ten.", ans:false},
      ]
    },
    song:null
  },
  {
    id:"u1l5", unit:1, lessonIndex:4, title:"Lesson 5", subtitle:"Numbers 11‚Äì20", vocabTopic:"Numbers 11‚Äì20",
    vocab:[
      {en:"eleven", ru:"11", img:""},
      {en:"twelve", ru:"12", img:""},
      {en:"fifteen", ru:"15", img:""},
      {en:"twenty", ru:"20", img:""},
    ],
    grammar:{
      title:"I‚Äôm ‚Ä¶ (age)",
      rule:"Use numbers to say your age.",
      formula:"I‚Äôm + number.",
      mcq:[
        {q:"15 is:", options:["twelve","fifteen","twenty"], ans:"fifteen"},
        {q:"20 is:", options:["twenty","eleven","three"], ans:"twenty"},
      ]
    },
    reading:{
      text:["My name is Ann.","I‚Äôm twelve."],
      tf:[
        {q:"Ann is twelve.", ans:true},
        {q:"Ann is eleven.", ans:false},
      ]
    },
    song:null
  },
  {
    id:"u1l6", unit:1, lessonIndex:5, title:"Lesson 6", subtitle:"Colours", vocabTopic:"Colours",
    vocab:[
      {en:"red", ru:"–∫—Ä–∞—Å–Ω—ã–π", img:""},
      {en:"blue", ru:"—Å–∏–Ω–∏–π", img:""},
      {en:"green", ru:"–∑–µ–ª—ë–Ω—ã–π", img:""},
      {en:"yellow", ru:"–∂—ë–ª—Ç—ã–π", img:""},
    ],
    grammar:{
      title:"It is ‚Ä¶ (colour)",
      rule:'We say: "It is red." / "It is blue."',
      formula:"It is + colour.",
      mcq:[
        {q:"The sky is ___", options:["blue","ten","hello"], ans:"blue"},
        {q:"A banana is ___", options:["yellow","green","goodbye"], ans:"yellow"},
      ]
    },
    reading:{
      text:["The ball is red."],
      tf:[
        {q:"The ball is red.", ans:true},
        {q:"The ball is blue.", ans:false},
      ]
    },
    song:null
  },
  {
    id:"u1l7", unit:1, lessonIndex:6, title:"Lesson 7", subtitle:"Where are you from?", vocabTopic:"Countries",
    vocab:[
      {en:"Kazakhstan", ru:"–ö–∞–∑–∞—Ö—Å—Ç–∞–Ω", img:""},
      {en:"the UK", ru:"–í–µ–ª–∏–∫–æ–±—Ä–∏—Ç–∞–Ω–∏—è", img:""},
      {en:"the USA", ru:"–°–®–ê", img:""},
      {en:"Russia", ru:"–†–æ—Å—Å–∏—è", img:""},
    ],
    grammar:{
      title:"Where are you from?",
      rule:'We ask: "Where are you from?" We answer: "I‚Äôm from ‚Ä¶".',
      formula:"Where are you from? ‚Üí I‚Äôm from ‚Ä¶",
      mcq:[
        {q:"I‚Äôm from ___", options:["Kazakhstan","blue","hello"], ans:"Kazakhstan"},
        {q:"A country:", options:["the UK","fine","goodbye"], ans:"the UK"},
      ]
    },
    reading:{
      text:["I‚Äôm Tom.","I‚Äôm from the UK."],
      tf:[
        {q:"Tom is from the UK.", ans:true},
        {q:"Tom is from Russia.", ans:false},
      ]
    },
    song:null
  },
  {
    id:"u1l8", unit:1, lessonIndex:7, title:"Lesson 8", subtitle:"Project", vocabTopic:"About me",
    vocab:[
      {en:"name", ru:"–∏–º—è", img:""},
      {en:"age", ru:"–≤–æ–∑—Ä–∞—Å—Ç", img:""},
      {en:"country", ru:"—Å—Ç—Ä–∞–Ω–∞", img:""},
      {en:"favourite colour", ru:"–ª—é–±–∏–º—ã–π —Ü–≤–µ—Ç", img:""},
    ],
    grammar:{
      title:"My poster",
      rule:"We can write simple sentences about us.",
      formula:"My name is‚Ä¶ I‚Äôm‚Ä¶ I‚Äôm from‚Ä¶ My favourite colour is‚Ä¶",
      mcq:[
        {q:"My favourite colour is ___", options:["blue","Kazakhstan","hello"], ans:"blue"},
        {q:"My ___ is Tom.", options:["name","yellow","goodbye"], ans:"name"},
      ]
    },
    reading:{
      text:["My name is Ali.","I‚Äôm nine.","I‚Äôm from Kazakhstan."],
      tf:[
        {q:"Ali is nine.", ans:true},
        {q:"Ali is from the UK.", ans:false},
      ]
    },
    song:null
  }
];

/* Unit 2‚Äì8: –≥–æ—Ç–æ–≤—ã–µ 8 lessons —Å vocab + –∫–∞—Ä—Ç–∏–Ω–∫–∞–º–∏ */
const UNIT2 = [
  lessonTemplate(2,0,"My school","School things",[["book","–∫–Ω–∏–≥–∞"],["pen","—Ä—É—á–∫–∞"],["pencil","–∫–∞—Ä–∞–Ω–¥–∞—à"],["bag","—Å—É–º–∫–∞"]],"This is a‚Ä¶","We say: This is a book.","This is a + noun."),
  lessonTemplate(2,1,"In the classroom","Classroom",[["desk","–ø–∞—Ä—Ç–∞"],["chair","—Å—Ç—É–ª"],["board","–¥–æ—Å–∫–∞"],["window","–æ–∫–Ω–æ"]],"Where is‚Ä¶?","We ask: Where is the book?","Where is + noun?"),
  lessonTemplate(2,2,"People at school","People",[["teacher","—É—á–∏—Ç–µ–ª—å"],["student","—É—á–µ–Ω–∏–∫"],["friend","–¥—Ä—É–≥"],["class","–∫–ª–∞—Å—Å"]],"I am a‚Ä¶","We say: I am a student.","I am a + noun."),
  lessonTemplate(2,3,"School subjects","Subjects",[["english","–∞–Ω–≥–ª–∏–π—Å–∫–∏–π"],["maths","–º–∞—Ç–µ–º–∞—Ç–∏–∫–∞"],["art","—Ä–∏—Å–æ–≤–∞–Ω–∏–µ"],["music","–º—É–∑—ã–∫–∞"]],"I like‚Ä¶","We say: I like English.","I like + noun."),
  lessonTemplate(2,4,"Days","Days",[["monday","–ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫"],["tuesday","–≤—Ç–æ—Ä–Ω–∏–∫"],["wednesday","—Å—Ä–µ–¥–∞"],["friday","–ø—è—Ç–Ω–∏—Ü–∞"]],"Today is‚Ä¶","We say: Today is Monday.","Today is + day."),
  lessonTemplate(2,5,"My timetable","Timetable",[["lesson","—É—Ä–æ–∫"],["break","–ø–µ—Ä–µ–º–µ–Ω–∞"],["homework","–¥–æ–º–∞—à–∫–∞"],["bell","–∑–≤–æ–Ω–æ–∫"]],"I have‚Ä¶","We say: I have Maths.","I have + subject."),
  lessonTemplate(2,6,"My classroom","My classroom",[["big","–±–æ–ª—å—à–æ–π"],["small","–º–∞–ª–µ–Ω—å–∫–∏–π"],["clean","—á–∏—Å—Ç—ã–π"],["nice","–∫—Ä–∞—Å–∏–≤—ã–π"]],"It is‚Ä¶","We say: It is big.","It is + adjective."),
  lessonTemplate(2,7,"Project","Project",[["my school","–º–æ—è —à–∫–æ–ª–∞"],["my teacher","–º–æ–π —É—á–∏—Ç–µ–ª—å"],["my friend","–º–æ–π –¥—Ä—É–≥"],["my class","–º–æ–π –∫–ª–∞—Å—Å"]],"My‚Ä¶","We say: My school is nice.","My + noun + is + adjective.")
];

const UNIT3 = [
  lessonTemplate(3,0,"My family","Family",[["mother","–º–∞–º–∞"],["father","–ø–∞–ø–∞"],["sister","—Å–µ—Å—Ç—Ä–∞"],["brother","–±—Ä–∞—Ç"]],"This is my‚Ä¶","We say: This is my mother.","This is my + noun."),
  lessonTemplate(3,1,"Grandparents","Family",[["grandma","–±–∞–±—É—à–∫–∞"],["grandpa","–¥–µ–¥—É—à–∫–∞"],["baby","–º–∞–ª—ã—à"],["family","—Å–µ–º—å—è"]],"I love‚Ä¶","We say: I love my family.","I love + noun."),
  lessonTemplate(3,2,"My friends","Friends",[["friend","–¥—Ä—É–≥"],["girl","–¥–µ–≤–æ—á–∫–∞"],["boy","–º–∞–ª—å—á–∏–∫"],["happy","—Å—á–∞—Å—Ç–ª–∏–≤—ã–π"]],"He/She is‚Ä¶","We say: She is happy.","He/She is + adjective."),
  lessonTemplate(3,3,"Feelings","Feelings",[["happy","—Å—á–∞—Å—Ç–ª–∏–≤—ã–π"],["sad","–≥—Ä—É—Å—Ç–Ω—ã–π"],["tired","—É—Å—Ç–∞–≤—à–∏–π"],["angry","—Å–µ—Ä–¥–∏—Ç—ã–π"]],"How are you?","We ask and answer about feelings.","How are you? ‚Üí I‚Äôm ‚Ä¶"),
  lessonTemplate(3,4,"Pets","Pets",[["cat","–∫–æ—Ç"],["dog","—Å–æ–±–∞–∫–∞"],["fish","—Ä—ã–±–∫–∞"],["pet","–ø–∏—Ç–æ–º–µ—Ü"]],"I have‚Ä¶","We say: I have a cat.","I have a + noun."),
  lessonTemplate(3,5,"My home","Home",[["house","–¥–æ–º"],["room","–∫–æ–º–Ω–∞—Ç–∞"],["bed","–∫—Ä–æ–≤–∞—Ç—å"],["door","–¥–≤–µ—Ä—å"]],"There is‚Ä¶","We say: There is a bed.","There is a + noun."),
  lessonTemplate(3,6,"Helping","Help",[["help","–ø–æ–º–æ–≥–∞—Ç—å"],["cook","–≥–æ—Ç–æ–≤–∏—Ç—å"],["clean","—É–±–∏—Ä–∞—Ç—å"],["wash","–º—ã—Ç—å"]],"I can‚Ä¶","We say: I can help.","I can + verb."),
  lessonTemplate(3,7,"Project","Project",[["my family","–º–æ—è —Å–µ–º—å—è"],["my friend","–º–æ–π –¥—Ä—É–≥"],["my pet","–º–æ–π –ø–∏—Ç–æ–º–µ—Ü"],["my home","–º–æ–π –¥–æ–º"]],"My poster","We write about people we love.","My ‚Ä¶ is ‚Ä¶")
];

const UNIT4 = [
  lessonTemplate(4,0,"Sunny day","Weather",[["sunny","—Å–æ–ª–Ω–µ—á–Ω–æ"],["hot","–∂–∞—Ä–∫–æ"],["summer","–ª–µ—Ç–æ"],["sun","—Å–æ–ª–Ω—Ü–µ"]],"It is‚Ä¶","We say: It is sunny.","It is + weather."),
  lessonTemplate(4,1,"Rainy day","Weather",[["rainy","–¥–æ–∂–¥–ª–∏–≤–æ"],["umbrella","–∑–æ–Ω—Ç"],["boots","—Å–∞–ø–æ–≥–∏"],["puddle","–ª—É–∂–∞"]],"I have‚Ä¶","We say: I have an umbrella.","I have + noun."),
  lessonTemplate(4,2,"Cloudy","Weather",[["cloudy","–æ–±–ª–∞—á–Ω–æ"],["cloud","–æ–±–ª–∞–∫–æ"],["grey","—Å–µ—Ä—ã–π"],["sky","–Ω–µ–±–æ"]],"The sky is‚Ä¶","We say: The sky is grey.","The sky is + adjective."),
  lessonTemplate(4,3,"Windy","Weather",[["windy","–≤–µ—Ç—Ä–µ–Ω–æ"],["wind","–≤–µ—Ç–µ—Ä"],["kite","–≤–æ–∑–¥—É—à–Ω—ã–π –∑–º–µ–π"],["cold","—Ö–æ–ª–æ–¥–Ω–æ"]],"I can‚Ä¶","We say: I can fly a kite.","I can + verb."),
  lessonTemplate(4,4,"Snowy","Weather",[["snowy","—Å–Ω–µ–∂–Ω–æ"],["snow","—Å–Ω–µ–≥"],["winter","–∑–∏–º–∞"],["hat","—à–∞–ø–∫–∞"]],"I wear‚Ä¶","We say: I wear a hat.","I wear + clothes."),
  lessonTemplate(4,5,"Seasons","Seasons",[["spring","–≤–µ—Å–Ω–∞"],["summer","–ª–µ—Ç–æ"],["autumn","–æ—Å–µ–Ω—å"],["winter","–∑–∏–º–∞"]],"My favourite‚Ä¶","We say: My favourite season is summer.","My favourite ‚Ä¶ is ‚Ä¶"),
  lessonTemplate(4,6,"Clothes","Clothes",[["coat","–ø–∞–ª—å—Ç–æ"],["jacket","–∫—É—Ä—Ç–∫–∞"],["t-shirt","—Ñ—É—Ç–±–æ–ª–∫–∞"],["shoes","–æ–±—É–≤—å"]],"Put on‚Ä¶","We say: Put on your coat.","Put on + noun."),
  lessonTemplate(4,7,"Project","Project",[["weather","–ø–æ–≥–æ–¥–∞"],["season","—Å–µ–∑–æ–Ω"],["today","—Å–µ–≥–æ–¥–Ω—è"],["tomorrow","–∑–∞–≤—Ç—Ä–∞"]],"Today is‚Ä¶","We say: Today is sunny.","Today is + weather.")
];

const UNIT5 = [
  lessonTemplate(5,0,"Sports","Free time",[["football","—Ñ—É—Ç–±–æ–ª"],["basketball","–±–∞—Å–∫–µ—Ç–±–æ–ª"],["swimming","–ø–ª–∞–≤–∞–Ω–∏–µ"],["running","–±–µ–≥"]],"I like‚Ä¶","We say: I like football.","I like + activity."),
  lessonTemplate(5,1,"Hobbies","Free time",[["reading","—á—Ç–µ–Ω–∏–µ"],["drawing","—Ä–∏—Å–æ–≤–∞–Ω–∏–µ"],["music","–º—É–∑—ã–∫–∞"],["dance","—Ç–∞–Ω—Ü—ã"]],"I can‚Ä¶","We say: I can dance.","I can + verb."),
  lessonTemplate(5,2,"Games","Free time",[["game","–∏–≥—Ä–∞"],["toy","–∏–≥—Ä—É—à–∫–∞"],["ball","–º—è—á"],["bike","–≤–µ–ª–æ—Å–∏–ø–µ–¥"]],"Let‚Äôs‚Ä¶","We say: Let‚Äôs play!","Let‚Äôs + verb."),
  lessonTemplate(5,3,"At the park","Free time",[["park","–ø–∞—Ä–∫"],["tree","–¥–µ—Ä–µ–≤–æ"],["swing","–∫–∞—á–µ–ª–∏"],["slide","–≥–æ—Ä–∫–∞"]],"I go to‚Ä¶","We say: I go to the park.","I go to + place."),
  lessonTemplate(5,4,"At home","Free time",[["home","–¥–æ–º"],["tv","—Ç–µ–ª–µ–≤–∏–∑–æ—Ä"],["computer","–∫–æ–º–ø—å—é—Ç–µ—Ä"],["phone","—Ç–µ–ª–µ—Ñ–æ–Ω"]],"I watch‚Ä¶","We say: I watch TV.","I watch + noun."),
  lessonTemplate(5,5,"Time","Free time",[["morning","—É—Ç—Ä–æ"],["afternoon","–¥–µ–Ω—å"],["evening","–≤–µ—á–µ—Ä"],["night","–Ω–æ—á—å"]],"In the‚Ä¶","We say: In the morning‚Ä¶","In the + time."),
  lessonTemplate(5,6,"My weekend","Free time",[["weekend","–≤—ã—Ö–æ–¥–Ω—ã–µ"],["Saturday","—Å—É–±–±–æ—Ç–∞"],["Sunday","–≤–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ"],["fun","–≤–µ—Å–µ–ª–æ"]],"On Saturday‚Ä¶","We say: On Saturday I‚Ä¶","On + day + I + verb."),
  lessonTemplate(5,7,"Project","Project",[["my hobby","–º–æ—ë —Ö–æ–±–±–∏"],["my sport","–º–æ–π —Å–ø–æ—Ä—Ç"],["my weekend","–º–æ–∏ –≤—ã—Ö–æ–¥–Ω—ã–µ"],["my favourite","–º–æ–π –ª—é–±–∏–º—ã–π"]],"My favourite‚Ä¶","We say: My favourite hobby is reading.","My favourite ‚Ä¶ is ‚Ä¶")
];

const UNIT6 = [
  lessonTemplate(6,0,"I feel ill","Health",[["headache","–≥–æ–ª–æ–≤–Ω–∞—è –±–æ–ª—å"],["toothache","–∑—É–±–Ω–∞—è –±–æ–ª—å"],["cold","–ø—Ä–æ—Å—Ç—É–¥–∞"],["fever","—Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞"]],"I‚Äôve got‚Ä¶","We say: I‚Äôve got a headache.","I‚Äôve got a + illness."),
  lessonTemplate(6,1,"At the doctor","Health",[["doctor","–≤—Ä–∞—á"],["hospital","–±–æ–ª—å–Ω–∏—Ü–∞"],["medicine","–ª–µ–∫–∞—Ä—Å—Ç–≤–æ"],["nurse","–º–µ–¥—Å–µ—Å—Ç—Ä–∞"]],"Go to‚Ä¶","We say: Go to the doctor.","Go to + place/person."),
  lessonTemplate(6,2,"Body","Health",[["head","–≥–æ–ª–æ–≤–∞"],["hand","—Ä—É–∫–∞"],["leg","–Ω–æ–≥–∞"],["eye","–≥–ª–∞–∑"]],"My‚Ä¶ hurts","We say: My leg hurts.","My + body + hurts."),
  lessonTemplate(6,3,"Healthy food","Health",[["apple","—è–±–ª–æ–∫–æ"],["banana","–±–∞–Ω–∞–Ω"],["water","–≤–æ–¥–∞"],["milk","–º–æ–ª–æ–∫–æ"]],"I drink/eat‚Ä¶","We say: I drink water.","I eat/drink + noun."),
  lessonTemplate(6,4,"Sports are good","Health",[["walk","–≥—É–ª—è—Ç—å"],["run","–±–µ–≥–∞—Ç—å"],["jump","–ø—Ä—ã–≥–∞—Ç—å"],["swim","–ø–ª–∞–≤–∞—Ç—å"]],"Let‚Äôs‚Ä¶","We say: Let‚Äôs run!","Let‚Äôs + verb."),
  lessonTemplate(6,5,"Good habits","Health",[["sleep","—Å–ø–∞—Ç—å"],["wash","–º—ã—Ç—å"],["brush teeth","—á–∏—Å—Ç–∏—Ç—å –∑—É–±—ã"],["clean","—á–∏—Å—Ç–æ"]],"I‚Ä¶ every day","We say: I wash every day.","I + verb + every day."),
  lessonTemplate(6,6,"Safety","Health",[["careful","–æ—Å—Ç–æ—Ä–æ–∂–Ω–æ"],["stop","—Å—Ç–æ–π"],["danger","–æ–ø–∞—Å–Ω–æ"],["help","–ø–æ–º–æ–≥–∏"]],"Don‚Äôt‚Ä¶","We say: Don‚Äôt run!","Don‚Äôt + verb."),
  lessonTemplate(6,7,"Project","Project",[["healthy","–∑–¥–æ—Ä–æ–≤—ã–π"],["food","–µ–¥–∞"],["sport","—Å–ø–æ—Ä—Ç"],["doctor","–≤—Ä–∞—á"]],"I want to be‚Ä¶","We say: I want to be healthy.","I want to be + adjective.")
];

const UNIT7 = [
  lessonTemplate(7,0,"City places","Buildings",[["school","—à–∫–æ–ª–∞"],["house","–¥–æ–º"],["shop","–º–∞–≥–∞–∑–∏–Ω"],["park","–ø–∞—Ä–∫"]],"There is‚Ä¶","We say: There is a school.","There is a + place."),
  lessonTemplate(7,1,"Street","Buildings",[["street","—É–ª–∏—Ü–∞"],["road","–¥–æ—Ä–æ–≥–∞"],["car","–º–∞—à–∏–Ω–∞"],["bus","–∞–≤—Ç–æ–±—É—Å"]],"I go by‚Ä¶","We say: I go by bus.","I go by + transport."),
  lessonTemplate(7,2,"In the town","Buildings",[["library","–±–∏–±–ª–∏–æ—Ç–µ–∫–∞"],["museum","–º—É–∑–µ–π"],["cinema","–∫–∏–Ω–æ"],["cafe","–∫–∞—Ñ–µ"]],"Let‚Äôs go to‚Ä¶","We say: Let‚Äôs go to the park.","Let‚Äôs go to + place."),
  lessonTemplate(7,3,"Directions","Buildings",[["left","–Ω–∞–ª–µ–≤–æ"],["right","–Ω–∞–ø—Ä–∞–≤–æ"],["straight","–ø—Ä—è–º–æ"],["near","—Ä—è–¥–æ–º"]],"Go‚Ä¶","We say: Go left.","Go + direction."),
  lessonTemplate(7,4,"My room","Buildings",[["bed","–∫—Ä–æ–≤–∞—Ç—å"],["table","—Å—Ç–æ–ª"],["chair","—Å—Ç—É–ª"],["lamp","–ª–∞–º–ø–∞"]],"There is/are‚Ä¶","We say: There is a lamp.","There is/are + noun."),
  lessonTemplate(7,5,"Big buildings","Buildings",[["tall","–≤—ã—Å–æ–∫–∏–π"],["big","–±–æ–ª—å—à–æ–π"],["small","–º–∞–ª–µ–Ω—å–∫–∏–π"],["new","–Ω–æ–≤—ã–π"]],"It is‚Ä¶","We say: It is tall.","It is + adjective."),
  lessonTemplate(7,6,"Shops","Buildings",[["bakery","–ø–µ–∫–∞—Ä–Ω—è"],["pharmacy","–∞–ø—Ç–µ–∫–∞"],["market","—Ä—ã–Ω–æ–∫"],["bank","–±–∞–Ω–∫"]],"I want‚Ä¶","We say: I want bread.","I want + noun."),
  lessonTemplate(7,7,"Project","Project",[["my town","–º–æ–π –≥–æ—Ä–æ–¥"],["my street","–º–æ—è —É–ª–∏—Ü–∞"],["my house","–º–æ–π –¥–æ–º"],["my school","–º–æ—è —à–∫–æ–ª–∞"]],"My place","We write about our town.","My ‚Ä¶ is ‚Ä¶")
];

const UNIT8 = [
  lessonTemplate(8,0,"Summer holidays","Holidays",[["holiday","–∫–∞–Ω–∏–∫—É–ª—ã"],["summer","–ª–µ—Ç–æ"],["beach","–ø–ª—è–∂"],["sun","—Å–æ–ª–Ω—Ü–µ"]],"I go to‚Ä¶","We say: I go to the beach.","I go to + place."),
  lessonTemplate(8,1,"Winter holidays","Holidays",[["winter","–∑–∏–º–∞"],["snow","—Å–Ω–µ–≥"],["ski","–ª—ã–∂–∏"],["skate","–∫–æ–Ω—å–∫–∏"]],"I can‚Ä¶","We say: I can ski.","I can + verb."),
  lessonTemplate(8,2,"Travel","Holidays",[["plane","—Å–∞–º–æ–ª—ë—Ç"],["train","–ø–æ–µ–∑–¥"],["bus","–∞–≤—Ç–æ–±—É—Å"],["car","–º–∞—à–∏–Ω–∞"]],"I go by‚Ä¶","We say: I go by train.","I go by + transport."),
  lessonTemplate(8,3,"Hotel","Holidays",[["hotel","–æ—Ç–µ–ª—å"],["room","–∫–æ–º–Ω–∞—Ç–∞"],["key","–∫–ª—é—á"],["bed","–∫—Ä–æ–≤–∞—Ç—å"]],"This is‚Ä¶","We say: This is a room.","This is a + noun."),
  lessonTemplate(8,4,"Things to take","Holidays",[["bag","—Å—É–º–∫–∞"],["t-shirt","—Ñ—É—Ç–±–æ–ª–∫–∞"],["hat","—à–∞–ø–∫–∞"],["water","–≤–æ–¥–∞"]],"I take‚Ä¶","We say: I take a bag.","I take + noun."),
  lessonTemplate(8,5,"Photos","Holidays",[["photo","—Ñ–æ—Ç–æ"],["camera","–∫–∞–º–µ—Ä–∞"],["smile","—É–ª—ã–±–∫–∞"],["family","—Å–µ–º—å—è"]],"I like‚Ä¶","We say: I like photos.","I like + noun."),
  lessonTemplate(8,6,"Fun day","Holidays",[["fun","–≤–µ—Å–µ–ª–æ"],["game","–∏–≥—Ä–∞"],["ice cream","–º–æ—Ä–æ–∂–µ–Ω–æ–µ"],["friend","–¥—Ä—É–≥"]],"Let‚Äôs‚Ä¶","We say: Let‚Äôs play!","Let‚Äôs + verb."),
  lessonTemplate(8,7,"Project","Holidays",[["my holiday","–º–æ–∏ –∫–∞–Ω–∏–∫—É–ª—ã"],["my trip","–º–æ—è –ø–æ–µ–∑–¥–∫–∞"],["my photo","–º–æ—ë —Ñ–æ—Ç–æ"],["my plan","–º–æ–π –ø–ª–∞–Ω"]],"My story","We write about our holidays.","My holiday is ‚Ä¶")
];

const UNITS = [
  {unit:1, title:"Unit 1 ‚Äî Hello English!", lessons: UNIT1},
  {unit:2, title:"Unit 2 ‚Äî My school", lessons: UNIT2},
  {unit:3, title:"Unit 3 ‚Äî People I love", lessons: UNIT3},
  {unit:4, title:"Unit 4 ‚Äî Weather", lessons: UNIT4},
  {unit:5, title:"Unit 5 ‚Äî My free time", lessons: UNIT5},
  {unit:6, title:"Unit 6 ‚Äî Health", lessons: UNIT6},
  {unit:7, title:"Unit 7 ‚Äî Buildings", lessons: UNIT7},
  {unit:8, title:"Unit 8 ‚Äî My holidays", lessons: UNIT8},
];

/* ===================== DB ===================== */
function loadDB(){
  try{
    const raw = localStorage.getItem(STORAGE_KEY);
    if(raw) return JSON.parse(raw);
  }catch(e){}
  return { user:null, stars:{}, done:{}, chatLast:{}, logs:[] };
}
let db = loadDB();
function saveDB(){ localStorage.setItem(STORAGE_KEY, JSON.stringify(db)); }

function nowStr(){ return new Date().toLocaleString(); }
function todayKey(){ return new Date().toDateString(); }

function totalStarsFor(login){
  const m = db.stars[login] || {};
  return Object.values(m).reduce((a,b)=>a+(+b||0),0);
}
function lessonStars(login, lessonId){
  return (db.stars[login] && db.stars[login][lessonId]) ? db.stars[login][lessonId] : 0;
}
function isDone(login, lessonId){
  return !!(db.done[login] && db.done[login][lessonId]);
}
function setDone(login, lessonId){
  db.done[login] = db.done[login] || {};
  db.done[login][lessonId] = true;
}
function addStars(login, lessonId, delta){
  db.stars[login] = db.stars[login] || {};
  db.stars[login][lessonId] = (db.stars[login][lessonId] || 0) + delta;
}

/* ===================== THEME HELPERS ===================== */
function setCSSVar(name, val){ document.documentElement.style.setProperty(name, val); }
function darkenHex(hex, amt=0.22){
  const h = String(hex).replace("#","");
  if(h.length!==6) return hex;
  const r = parseInt(h.slice(0,2),16);
  const g = parseInt(h.slice(2,4),16);
  const b = parseInt(h.slice(4,6),16);
  const nr = Math.max(0, Math.floor(r*(1-amt)));
  const ng = Math.max(0, Math.floor(g*(1-amt)));
  const nb = Math.max(0, Math.floor(b*(1-amt)));
  const to = (n)=>n.toString(16).padStart(2,"0");
  return "#"+to(nr)+to(ng)+to(nb);
}
function applyTheme(unitNum=null, lessonIndex=null){
  if(!unitNum){
    setCSSVar("--appA","#0b6f78");
    setCSSVar("--appB","#0a5f67");
    setCSSVar("--secA","#0b6f78");
    setCSSVar("--secB","#15909b");
    return;
  }
  const shades = unitThemes[unitNum]?.shades || ["#0b6f78","#0a5f67"];
  const appA = shades[6] || shades[5] || "#0b6f78";
  const appB = shades[7] || darkenHex(appA,0.25);
  setCSSVar("--appA", appA);
  setCSSVar("--appB", appB);

  if(lessonIndex===null || lessonIndex===undefined){
    setCSSVar("--secA", shades[5] || appA);
    setCSSVar("--secB", shades[6] || appB);
  }else{
    const lessonShade = shades[lessonIndex] || shades[5] || appA;
    setCSSVar("--secA", lessonShade);
    setCSSVar("--secB", darkenHex(lessonShade,0.28));
  }
}

/* ===================== ROUTER ===================== */
const app = document.getElementById("app");
let route = {page:"auth"};

function go(page, params={}){
  route = {page, ...params};
  if(page==="auth" || page==="menu" || page==="chat" || page==="journal"){
    applyTheme(null,null);
  }else if(page==="unit"){
    applyTheme(route.unit, null);
  }else if(page==="lesson"){
    applyTheme(route.unit, null);
  }
  render();
}

function render(){
  if(route.page==="auth") return renderAuth();
  if(!db.user) return renderAuth();
  if(route.page==="menu") return renderMenu();
  if(route.page==="unit") return renderUnit(route.unit);
  if(route.page==="lesson") return renderLesson(route.unit, route.lessonId);
  if(route.page==="chat") return renderChat();
  if(route.page==="journal") return renderJournal();
  renderMenu();
}

/* ===================== AUTH (–±–µ–∑ –ø–æ–¥—Å–∫–∞–∑–æ–∫ PIN) ===================== */
function validStudentLogin(login){
  const s = (login||"").trim().toUpperCase();
  const m = s.match(/^3EL([1-9]|1[0-5])$/);
  return !!m;
}

function renderAuth(){
  applyTheme(null,null);
  app.innerHTML = `
    <div class="hero">
      <div class="logoWrap">
        <img src="logo.png" alt="logo" onerror="this.style.display='none'; this.parentElement.innerHTML='üëß'; this.parentElement.style.fontSize='64px'; this.parentElement.style.color='#0b6f78'">
      </div>
      <h1 class="brandTitle">AI BAYAN</h1>
      <div class="brandSub">Visual Vocabulary ‚Ä¢ Grade 3</div>
    </div>

    <div class="panel" style="max-width:520px">
      <div class="field">
        <div class="label">Login</div>
        <input class="input" id="login" placeholder="">
      </div>
      <div class="field">
        <div class="label">PIN</div>
        <input class="input" id="pin" type="password" placeholder="">
      </div>

      <div class="row">
        <button class="btn btnPrimary" style="flex:1;min-width:180px" onclick="handleLogin()">Enter</button>
      </div>
    </div>

    <div class="footline">AI BAYAN ‚Ä¢ Grade 3</div>
  `;
}

function handleLogin(){
  const login = (document.getElementById("login").value || "").trim().toUpperCase();
  const pin = (document.getElementById("pin").value || "").trim();

  if(pin === TEACHER_PIN){
    db.user = {type:"teacher", login:"TEACHER"};
    db.logs.push({ts: nowStr(), login:"TEACHER", action:"teacher_login"});
    saveDB();
    go("menu");
    return;
  }

  if(pin === STUDENT_PIN && validStudentLogin(login)){
    db.user = {type:"student", login};
    db.logs.push({ts: nowStr(), login, action:"student_login"});
    saveDB();
    go("menu");
    return;
  }

  alert("Wrong login or PIN.");
}

/* ===================== MENU ===================== */
function logout(){
  db.logs.push({ts: nowStr(), login: db.user?.login || "-", action:"logout"});
  db.user = null;
  saveDB();
  go("auth");
}

function renderMenu(){
  applyTheme(null,null);
  const who = db.user.type==="teacher" ? "Teacher" : db.user.login;

  app.innerHTML = `
    <div class="hero">
      <div class="logoWrap">
        <img src="logo.png" alt="logo" onerror="this.style.display='none'; this.parentElement.innerHTML='üëß'; this.parentElement.style.fontSize='64px'; this.parentElement.style.color='#0b6f78'">
      </div>
      <h1 class="brandTitle">ENGLISH WITH AI BAYAN</h1>
      <div class="brandSub">AI Bayan Visual Dictionary ‚Äî Grade 3</div>
    </div>

    <div class="panel">
      <div class="helloCard">
        <div class="big">Hello, ${escapeHtml(who)}!</div>
        <div class="small">Total stars: ${db.user.type==="student" ? totalStarsFor(db.user.login) : "‚Äî"} ‚≠ê</div>
      </div>

      <div class="menuGrid">
        ${UNITS.map(u=>{
          const shades = unitThemes[u.unit]?.shades || ["#0b6f78","#0a5f67"];
          const chip = shades[5] || "#0b6f78";
          const border = shades[6] || chip;
          return `
            <div class="menuBtn" onclick="go('unit',{unit:${u.unit}})"
                 style="border-color:${border}55">
              <div class="unitChip">
                <span class="dot" style="background:${chip}"></span>
                üìò ${escapeHtml(u.title)}
              </div>
              <small>Open Unit ${u.unit}</small>
            </div>
          `;
        }).join("")}
      </div>

      <div class="bottomRow">
        ${db.user.type==="student" ? `<div class="miniBtn" onclick="go('chat')">üí¨ AI Bayan Chat</div>` : ``}
        <div class="miniBtn" onclick="go('journal')">üè´ Teacher‚Äôs Journal</div>
        <div class="miniBtn" onclick="logout()">üö™ Exit</div>
      </div>
    </div>

    <div class="footline">AI BAYAN ‚Ä¢ Grade 3</div>
  `;
}

/* ===================== UNIT ===================== */
function renderUnit(unitNum){
  const u = UNITS.find(x=>x.unit===unitNum);
  if(!u) return go("menu");

  applyTheme(unitNum, null);

  const total = (db.user.type==="student") ? totalStarsFor(db.user.login) : 0;
  const shades = unitThemes[unitNum]?.shades || ["#0b6f78","#0a5f67"];
  const bannerA = shades[6] || shades[5] || "#0b6f78";
  const bannerB = shades[7] || darkenHex(bannerA,0.25);
  setCSSVar("--secA", bannerA);
  setCSSVar("--secB", bannerB);

  app.innerHTML = `
    <div class="panel">
      <div class="lessonBanner">
        <div>
          <div class="title">${escapeHtml(u.title)}</div>
          <div class="sub">Choose a lesson</div>
        </div>
        <div class="badge">‚≠ê Total: ${db.user.type==="student"?total:"‚Äî"}</div>
      </div>

      <div class="menuGrid">
        ${u.lessons.map((L,idx)=>{
          const ls = shades[idx] || shades[5] || "#0b6f78";
          const br = darkenHex(ls,0.25);
          return `
            <div class="menuBtn" onclick="go('lesson',{unit:${unitNum}, lessonId:'${L.id}'})"
                 style="border-color:${br}66">
              <div class="unitChip">
                <span class="dot" style="background:${ls}"></span>
                üìó Lesson ${idx+1} ‚Äî ${escapeHtml(L.subtitle)}
              </div>
              <small>${escapeHtml(L.vocabTopic)} ${db.user.type==="student" ? (isDone(db.user.login, L.id) ? "‚Ä¢ ‚úÖ done" : "") : ""}</small>
            </div>
          `;
        }).join("")}
      </div>

      <div class="bottomRow">
        <div class="miniBtn" onclick="go('menu')">‚Üê Main menu</div>
        ${db.user.type==="student" ? `<div class="miniBtn" onclick="go('chat')">üí¨ AI Bayan Chat</div>` : ``}
        <div class="miniBtn" onclick="go('journal')">üè´ Teacher‚Äôs Journal</div>
      </div>
    </div>

    <div class="footline">AI BAYAN ‚Ä¢ Grade 3 ‚Ä¢ 2025</div>
  `;
}

/* ===================== LESSON ===================== */
function renderLesson(unitNum, lessonId){
  const u = UNITS.find(x=>x.unit===unitNum);
  if(!u) return go("menu");
  const L = (u.lessons||[]).find(x=>x.id===lessonId);
  if(!L) return go("unit",{unit:unitNum});

  const shades = unitThemes[unitNum]?.shades || ["#0b6f78","#0a5f67"];
  const shade = shades[L.lessonIndex] || shades[5] || "#0b6f78";
  const shadeDark = darkenHex(shade, 0.30);

  applyTheme(unitNum, L.lessonIndex);
  setCSSVar("--secA", shade);
  setCSSVar("--secB", shadeDark);

  const login = db.user.login;
  const studentMode = (db.user.type==="student");
  const locked = studentMode ? isDone(login, lessonId) : false;
  const curStars = studentMode ? lessonStars(login, lessonId) : 0;

  app.innerHTML = `
    <div class="panel">
      <div class="lessonBanner">
        <div>
          <div class="title">${escapeHtml(u.title)} ‚Äî ${escapeHtml(L.subtitle)}</div>
          <div class="sub">${escapeHtml(L.vocabTopic)}</div>
        </div>
        <div class="badge">${studentMode ? `‚≠ê Stars: ${curStars}` : `Teacher view`}</div>
      </div>

      ${locked ? `<div style="font-weight:1000;color:#b21f1f;margin:6px 2px 10px">‚úÖ This lesson is already completed. (1 attempt)</div>` : ``}

      <div class="sectionTitle">üß† VOCABULARY ‚Äî Visual Dictionary</div>
      <div class="vocabGrid">
        ${L.vocab.map(w=>{
          const fallback = makeFallbackImg(w.en, unitNum, L.lessonIndex);
          const src = (w.img && w.img.trim()) ? w.img : fallback;
          return `
            <div class="vCard">
              <img src="${src}" data-fallback="${fallback}"
                   alt="${escapeHtml(w.en)}"
                   onerror="this.onerror=null; this.src=this.dataset.fallback;">
              <div class="vWord">${escapeHtml(w.en)}</div>
              <div class="vRu">${escapeHtml(w.ru)}</div>
            </div>
          `;
        }).join("")}
      </div>

      <div class="sectionTitle">üìò GRAMMAR ‚Äî Key Rule</div>
      <div class="wsBox">
        <h4>${escapeHtml(L.grammar.title)}</h4>
        <p style="font-weight:900">${escapeHtml(L.grammar.rule)}</p>
        <p><b>Formula:</b> ${escapeHtml(L.grammar.formula)}</p>
      </div>

      <div class="sectionTitle">üìù WORKSHEETS (4 tasks)</div>
      ${renderWS1(L, studentMode, locked)}
      ${renderWS2(L, studentMode, locked, unitNum, L.lessonIndex)}
      ${renderWS3(L, studentMode, locked)}
      ${renderWS4(L, studentMode, locked)}

      <div class="navRow">
        <button class="btn btnGhost" onclick="go('unit',{unit:${unitNum}})">‚Üê Back</button>
        ${studentMode ? `<button class="btn btnPrimary" onclick="finishLesson('${lessonId}', ${unitNum})">Finish lesson ‚úì</button>` : ``}
        <button class="btn btnGhost" onclick="window.print()">üñ® Print</button>
      </div>
    </div>

    <div class="footline">AI BAYAN ‚Ä¢ Grade 3 ‚Ä¢ 2025</div>
  `;
}

function renderWS1(L, studentMode, locked){
  const items = L.vocab.map(v=>{
    const raw = v.en.replace(/\?$/,"").trim();
    const w = raw.length<2 ? raw : raw;
    const idx = Math.max(1, Math.floor(w.length/2));
    const shown = w.slice(0,idx) + "_" + w.slice(idx+1);
    return {shown, ans: raw};
  });

  return `
    <div class="wsBox" id="ws1">
      <h4>Worksheet 1 ‚Äî Missing letters</h4>
      <p>Write the full word.</p>
      ${items.map((it,i)=>`
        <div class="qRow">
          <div class="q">${i+1}) ${escapeHtml(it.shown)} ‚Üí</div>
          <input type="text" ${(!studentMode || locked) ? "disabled" : ""} data-ans="${escapeHtml(it.ans)}"
                 onblur="checkText(this)" placeholder="">
        </div>
      `).join("")}
    </div>
  `;
}

function renderWS2(L, studentMode, locked, unitNum, lessonIndex){
  const opts = shuffle(L.vocab.map(v=>v.en));
  return `
    <div class="wsBox" id="ws2">
      <h4>Worksheet 2 ‚Äî Matching (picture ‚Üí word)</h4>
      <p>Choose the correct word for each picture. (One try for each.)</p>

      <div class="matchGrid">
        ${L.vocab.map((w,i)=>{
          const fallback = makeFallbackImg(w.en, unitNum, lessonIndex);
          const src = (w.img && w.img.trim()) ? w.img : fallback;
          return `
            <div class="matchCard" id="m${i}">
              <img src="${src}" data-fallback="${fallback}" onerror="this.onerror=null; this.src=this.dataset.fallback;">
              <div class="qRow" style="margin:10px 0 0">
                <select ${(!studentMode || locked) ? "disabled" : ""} data-ans="${escapeHtml(w.en)}"
                        onchange="checkSelect(this,'m${i}')">
                  <option value="">-- choose --</option>
                  ${opts.map(o=>`<option value="${escapeHtml(o)}">${escapeHtml(o)}</option>`).join("")}
                </select>
              </div>
            </div>
          `;
        }).join("")}
      </div>
    </div>
  `;
}

function renderWS3(L, studentMode, locked){
  return `
    <div class="wsBox" id="ws3">
      <h4>Worksheet 3 ‚Äî Grammar (choose)</h4>
      <p>Choose the correct answer.</p>
      ${L.grammar.mcq.map((q,i)=>`
        <div class="qRow">
          <div class="q">${i+1}) ${escapeHtml(q.q)}</div>
          <select ${(!studentMode || locked) ? "disabled" : ""} data-ans="${escapeHtml(q.ans)}"
                  onchange="checkSelect(this,'g${i}')">
            <option value="">-- choose --</option>
            ${shuffle(q.options).map(o=>`<option value="${escapeHtml(o)}">${escapeHtml(o)}</option>`).join("")}
          </select>
          <span id="g${i}" style="font-weight:1000"></span>
        </div>
      `).join("")}
    </div>
  `;
}

function renderWS4(L, studentMode, locked){
  const textHtml = (L.reading.text||[]).map(s=>`<div style="font-weight:900;color:#2f6168;margin:4px 0">${escapeHtml(s)}</div>`).join("");
  return `
    <div class="wsBox" id="ws4">
      <h4>Worksheet 4 ‚Äî Mini reading + True/False</h4>
      <p>Read and choose True or False.</p>

      <div style="background:#f6fbfc;border:2px solid rgba(12,106,115,.18);border-radius:14px;padding:10px">
        ${textHtml}
      </div>

      ${(L.reading.tf||[]).map((t,i)=>`
        <div class="qRow">
          <div class="q">${i+1}) ${escapeHtml(t.q)}</div>
          <select ${(!studentMode || locked) ? "disabled" : ""} data-ans="${t.ans ? "True" : "False"}"
                  onchange="checkSelect(this,'t${i}')">
            <option value="">-- choose --</option>
            <option value="True">True</option>
            <option value="False">False</option>
          </select>
          <span id="t${i}" style="font-weight:1000"></span>
        </div>
      `).join("")}
    </div>
  `;
}

/* ===================== CHECKERS ===================== */
function sparkle(el){
  const s = document.createElement("div");
  s.className = "spark";
  s.textContent = "‚≠ê";
  el.appendChild(s);
  setTimeout(()=>{ try{s.remove()}catch(e){} }, 700);
}
function lockControl(ctrl){ ctrl.disabled = true; }

function checkText(inp){
  if(inp.disabled) return;
  const ans = (inp.dataset.ans||"").trim().toLowerCase();
  const v = (inp.value||"").trim().toLowerCase();
  const ok = v && v===ans;

  inp.classList.remove("okBorder","badBorder");
  inp.classList.add(ok ? "okBorder" : "badBorder");

  const box = inp.closest(".wsBox");
  if(ok){ sparkle(box); addLessonStar(1); }
  lockControl(inp);
}

function checkSelect(sel, markId){
  if(sel.disabled) return;
  const ans = (sel.dataset.ans||"").trim().toLowerCase();
  const v = (sel.value||"").trim().toLowerCase();
  const ok = v && v===ans;

  sel.classList.remove("okBorder","badBorder");
  sel.classList.add(ok ? "okBorder" : "badBorder");

  const parentCard = document.getElementById(markId);
  if(parentCard && parentCard.classList){
    if(ok) parentCard.classList.add("correct");
    else parentCard.classList.add("wrong");
    const m = document.createElement("div");
    m.className = "mark";
    m.textContent = ok ? "‚úÖ" : "‚ùå";
    parentCard.appendChild(m);
    if(ok) sparkle(parentCard);
  }

  if(ok) addLessonStar(1);
  lockControl(sel);
}

function addLessonStar(delta){
  if(db.user?.type!=="student") return;
  const lessonId = route.lessonId;
  addStars(db.user.login, lessonId, delta);
  saveDB();
  try{
    const badge = document.querySelector(".badge");
    if(badge) badge.textContent = `‚≠ê Stars: ${lessonStars(db.user.login, lessonId)}`;
  }catch(e){}
}

/* ===================== FINISH (1 attempt) ===================== */
function finishLesson(lessonId, unitNum){
  if(db.user?.type!=="student") return;
  if(isDone(db.user.login, lessonId)){
    alert("Already completed.");
    return;
  }
  setDone(db.user.login, lessonId);
  db.logs.push({
    ts: nowStr(),
    login: db.user.login,
    action: "finish_lesson",
    lessonId,
    stars: lessonStars(db.user.login, lessonId)
  });
  saveDB();
  alert("Saved! Lesson completed ‚úÖ (1 attempt)");
  go("unit",{unit:unitNum});
}

/* ===================== CHAT ===================== */
function renderChat(){
  applyTheme(null,null);
  const login = db.user.login;
  const last = db.chatLast[login] || null;
  const today = todayKey();
  const blocked = (last === today);

  app.innerHTML = `
    <div class="panel">
      <div class="lessonBanner">
        <div>
          <div class="title">AI Bayan Chat</div>
          <div class="sub">Limit: 1 question per day</div>
        </div>
        <div class="badge">‚≠ê Total: ${totalStarsFor(login)}</div>
      </div>

      <div class="sectionTitle">üí¨ Chat</div>
      <div class="chatBox" id="chatBox">
        <div class="msgAi">AI Bayan: Hello! Ask me a simple question üòä</div>
      </div>

      <div style="margin-top:12px">
        ${blocked ? `
          <div style="font-weight:1000;color:#b21f1f">‚ùå You already asked today.</div>
        ` : `
          <div class="row">
            <input class="input" id="chatIn" placeholder="Type your question..." style="flex:1;min-width:240px">
            <button class="btn btnPrimary" style="min-width:150px" onclick="sendChat()">Send</button>
          </div>
        `}
      </div>

      <div class="navRow">
        <button class="btn btnGhost" onclick="go('menu')">‚Üê Back</button>
      </div>
    </div>

    <div class="footline">AI BAYAN ‚Ä¢ Grade 3 ‚Ä¢ 2025</div>
  `;
}

function sendChat(){
  const login = db.user.login;
  const today = todayKey();
  if(db.chatLast[login] === today){
    alert("Only 1 question per day.");
    return;
  }
  const inp = document.getElementById("chatIn");
  const msg = (inp.value||"").trim();
  if(!msg) return;

  const box = document.getElementById("chatBox");
  box.innerHTML += `<div class="msgMe">${escapeHtml(login)}: ${escapeHtml(msg)}</div>`;

  const m = msg.toLowerCase();
  let reply = "Good! üòä";
  if(m.includes("name")) reply = "My name is AI Bayan.";
  else if(m.includes("old")) reply = "I‚Äôm ten.";
  else if(m.includes("from")) reply = "I‚Äôm from Kazakhstan.";
  else if(m.includes("hello")) reply = "Hello!";
  else if(m.includes("how are you")) reply = "I‚Äôm fine. Thank you!";

  box.innerHTML += `<div class="msgAi">AI Bayan: ${escapeHtml(reply)}</div>`;
  box.scrollTop = box.scrollHeight;

  db.chatLast[login] = today;
  db.logs.push({ts: nowStr(), login, action:"chat_question"});
  saveDB();

  inp.value = "";
  setTimeout(()=>go("menu"), 900);
}

/* ===================== JOURNAL ===================== */
function renderJournal(){
  applyTheme(null,null);
  const isTeacher = db.user?.type==="teacher";

  const students = [];
  for(let i=1;i<=MAX_STUDENTS;i++){
    const login = `${CLASS_PREFIX}${i}`;
    const total = totalStarsFor(login);
    const doneCount = db.done[login] ? Object.keys(db.done[login]).length : 0;
    students.push({login,total,doneCount});
  }

  const logs = (db.logs||[]).slice().reverse().slice(0,120);

  app.innerHTML = `
    <div class="panel">
      <div class="lessonBanner">
        <div>
          <div class="title">Teacher‚Äôs Journal</div>
          <div class="sub">${isTeacher ? "Full access" : "View only"}</div>
        </div>
        <div class="badge">Logs: ${db.logs.length}</div>
      </div>

      <div class="sectionTitle">üë©‚Äçüè´ Students summary</div>
      <div style="overflow:auto;border:2px solid rgba(12,106,115,.18);border-radius:16px">
        <table>
          <thead>
            <tr>
              <th>Student</th>
              <th>Total ‚≠ê</th>
              <th>Done lessons</th>
            </tr>
          </thead>
          <tbody>
            ${students.map(s=>`
              <tr>
                <td>${escapeHtml(s.login)}</td>
                <td>${escapeHtml(String(s.total))}</td>
                <td>${escapeHtml(String(s.doneCount))}</td>
              </tr>
            `).join("")}
          </tbody>
        </table>
      </div>

      <div class="sectionTitle">üìí Activity log (latest)</div>
      <div style="overflow:auto;border:2px solid rgba(12,106,115,.18);border-radius:16px">
        <table>
          <thead>
            <tr>
              <th>Time</th>
              <th>Login</th>
              <th>Action</th>
              <th>Lesson</th>
              <th>Stars</th>
            </tr>
          </thead>
          <tbody>
            ${logs.map(r=>`
              <tr>
                <td>${escapeHtml(r.ts||"")}</td>
                <td>${escapeHtml(r.login||"")}</td>
                <td>${escapeHtml(r.action||"")}</td>
                <td>${escapeHtml(r.lessonId||"")}</td>
                <td>${escapeHtml(String(r.stars ?? ""))}</td>
              </tr>
            `).join("")}
          </tbody>
        </table>
      </div>

      <div class="bottomRow">
        ${isTeacher ? `<div class="miniBtn" onclick="resetAll()">üßπ Reset ALL data</div>` : ``}
        <div class="miniBtn" onclick="go('menu')">‚Üê Back</div>
      </div>
    </div>

    <div class="footline">AI BAYAN ‚Ä¢ Grade 3 ‚Ä¢ 2025</div>
  `;
}

function resetAll(){
  if(!confirm("Reset all saved data?")) return;
  db = { user: db.user, stars:{}, done:{}, chatLast:{}, logs:[{ts: nowStr(), login:"TEACHER", action:"reset_all"}] };
  saveDB();
  alert("All data reset.");
  renderJournal();
}

/* ===================== UTILS ===================== */
function escapeHtml(s){
  return String(s).replace(/[&<>"']/g, m => ({
    "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"
  }[m]));
}
function shuffle(arr){
  const a = arr.slice();
  for(let i=a.length-1;i>0;i--){
    const j = Math.floor(Math.random()*(i+1));
    [a[i],a[j]]=[a[j],a[i]];
  }
  return a;
}

/* ===================== START ===================== */
go(db.user ? "menu" : "auth");
</script>
</body>
</html>
